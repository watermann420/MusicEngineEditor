<Window x:Class="MusicEngineEditor.Views.ProjectBrowserView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:MusicEngineEditor.ViewModels"
        xmlns:models="clr-namespace:MusicEngineEditor.Models"
        xmlns:local="clr-namespace:MusicEngineEditor.Views"
        mc:Ignorable="d"
        Title="Project Browser"
        Height="600" Width="900"
        WindowStartupLocation="CenterOwner"
        Background="#1E1E1E">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <local:BoolToStarConverter x:Key="BoolToStar"/>
        <local:BoolToStarColorConverter x:Key="BoolToStarColor"/>
        <local:CountToVisibilityConverter x:Key="CountToVis"/>
        <local:NullToVisibilityConverter x:Key="NullToVis"/>
        <local:NullToBoolConverter x:Key="NullToBool"/>

        <!-- Project Item Template -->
        <DataTemplate x:Key="ProjectItemTemplate" DataType="{x:Type models:ProjectInfo}">
            <Border Padding="12,8" BorderThickness="0,0,0,1" BorderBrush="#333">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Favorite Star -->
                    <TextBlock Grid.Column="0"
                               Text="{Binding IsFavorite, Converter={StaticResource BoolToStar}}"
                               Foreground="{Binding IsFavorite, Converter={StaticResource BoolToStarColor}}"
                               FontSize="16"
                               VerticalAlignment="Center"
                               Margin="0,0,12,0"/>

                    <!-- Project Info -->
                    <StackPanel Grid.Column="1">
                        <TextBlock Text="{Binding Name}"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   Foreground="White"/>
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock Text="{Binding Bpm, StringFormat={}{0:F0} BPM}"
                                       Foreground="#888" FontSize="12"/>
                            <TextBlock Text=" | " Foreground="#555"/>
                            <TextBlock Text="{Binding PatternCount, StringFormat={}{0} patterns}"
                                       Foreground="#888" FontSize="12"/>
                            <TextBlock Text=" | " Foreground="#555"/>
                            <TextBlock Text="{Binding DurationFormatted}"
                                       Foreground="#888" FontSize="12"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Modified Date -->
                    <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Right">
                        <TextBlock Text="{Binding ModifiedRelative}"
                                   Foreground="#888"
                                   FontSize="12"
                                   HorizontalAlignment="Right"/>
                        <TextBlock Text="{Binding FileSizeFormatted}"
                                   Foreground="#666"
                                   FontSize="11"
                                   HorizontalAlignment="Right"/>
                    </StackPanel>
                </Grid>
            </Border>
        </DataTemplate>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#252526" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel>
                    <TextBlock Text="Project Browser"
                               FontSize="20"
                               FontWeight="Bold"
                               Foreground="White"/>
                    <TextBlock Text="{Binding CurrentPath}"
                               Foreground="#888"
                               FontSize="12"
                               Margin="0,4,0,0"/>
                </StackPanel>

                <Button Grid.Column="1"
                        Content="New Project"
                        Command="{Binding NewProjectCommand}"
                        Padding="16,8"
                        Background="#0078D4"
                        Foreground="White"
                        BorderThickness="0"/>
            </Grid>
        </Border>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="#2D2D30" Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search Box -->
                <Border Background="#3C3C3C" CornerRadius="4" Padding="8,4">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="&#xE721;"
                                   FontFamily="Segoe MDL2 Assets"
                                   Foreground="#888"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0"/>
                        <TextBox Grid.Column="1"
                                 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                 Background="Transparent"
                                 Foreground="White"
                                 BorderThickness="0"
                                 VerticalAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- Sort ComboBox -->
                <ComboBox Grid.Column="1"
                          SelectedItem="{Binding SortOption}"
                          Margin="12,0,0,0"
                          MinWidth="150">
                    <ComboBoxItem Content="Date Modified" Tag="{x:Static models:ProjectSortOption.DateModified}"/>
                    <ComboBoxItem Content="Name (A-Z)" Tag="{x:Static models:ProjectSortOption.Name}"/>
                    <ComboBoxItem Content="Name (Z-A)" Tag="{x:Static models:ProjectSortOption.NameDescending}"/>
                    <ComboBoxItem Content="Date Created" Tag="{x:Static models:ProjectSortOption.DateCreated}"/>
                    <ComboBoxItem Content="File Size" Tag="{x:Static models:ProjectSortOption.FileSize}"/>
                    <ComboBoxItem Content="BPM" Tag="{x:Static models:ProjectSortOption.Bpm}"/>
                </ComboBox>

                <!-- Favorites Toggle -->
                <ToggleButton Grid.Column="2"
                              IsChecked="{Binding ShowFavoritesOnly}"
                              Content="&#xE734;"
                              FontFamily="Segoe MDL2 Assets"
                              Margin="8,0,0,0"
                              Padding="8,4"
                              ToolTip="Show Favorites Only"/>

                <!-- Refresh Button -->
                <Button Grid.Column="3"
                        Content="&#xE72C;"
                        FontFamily="Segoe MDL2 Assets"
                        Command="{Binding RefreshCommand}"
                        Margin="8,0,0,0"
                        Padding="8,4"
                        ToolTip="Refresh"/>
            </Grid>
        </Border>

        <!-- Project List -->
        <Grid Grid.Row="2">
            <ListBox ItemsSource="{Binding FilteredProjects}"
                     SelectedItem="{Binding SelectedProject}"
                     ItemTemplate="{StaticResource ProjectItemTemplate}"
                     Background="Transparent"
                     BorderThickness="0"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                     MouseDoubleClick="ProjectList_MouseDoubleClick">
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0"/>
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="Background" Value="Transparent"/>
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#094771"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#2A2D2E"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>

            <!-- Loading Indicator -->
            <Border Background="#1E1E1E"
                    Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="Loading projects..."
                               Foreground="#888"
                               FontSize="14"/>
                </StackPanel>
            </Border>

            <!-- Empty State -->
            <Border Background="#1E1E1E"
                    Visibility="{Binding FilteredProjects.Count, Converter={StaticResource CountToVis}}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="&#xE8B7;"
                               FontFamily="Segoe MDL2 Assets"
                               FontSize="48"
                               Foreground="#555"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="No projects found"
                               Foreground="#888"
                               FontSize="14"
                               Margin="0,12,0,0"
                               HorizontalAlignment="Center"/>
                    <Button Content="Browse Folder"
                            Command="{Binding BrowseFolderCommand}"
                            Margin="0,12,0,0"
                            Padding="16,8"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Footer / Actions -->
        <Border Grid.Row="3" Background="#252526" Padding="12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Project Details -->
                <StackPanel Orientation="Horizontal"
                            Visibility="{Binding SelectedProject, Converter={StaticResource NullToVis}}">
                    <Button Content="&#xE734;"
                            FontFamily="Segoe MDL2 Assets"
                            Command="{Binding ToggleFavoriteCommand}"
                            Padding="8,4"
                            Margin="0,0,4,0"
                            ToolTip="Toggle Favorite"/>
                    <Button Content="&#xE8AC;"
                            FontFamily="Segoe MDL2 Assets"
                            Command="{Binding RenameProjectCommand}"
                            Padding="8,4"
                            Margin="0,0,4,0"
                            ToolTip="Rename"/>
                    <Button Content="&#xE8C8;"
                            FontFamily="Segoe MDL2 Assets"
                            Command="{Binding DuplicateProjectCommand}"
                            Padding="8,4"
                            Margin="0,0,4,0"
                            ToolTip="Duplicate"/>
                    <Button Content="&#xEDE1;"
                            FontFamily="Segoe MDL2 Assets"
                            Command="{Binding ExportProjectCommand}"
                            Padding="8,4"
                            Margin="0,0,4,0"
                            ToolTip="Export"/>
                    <Button Content="&#xF012;"
                            FontFamily="Segoe MDL2 Assets"
                            Command="{Binding ArchiveProjectCommand}"
                            Padding="8,4"
                            Margin="0,0,4,0"
                            ToolTip="Archive (ZIP)"/>
                    <Button Content="&#xE74D;"
                            FontFamily="Segoe MDL2 Assets"
                            Command="{Binding DeleteProjectCommand}"
                            Padding="8,4"
                            Margin="0,0,4,0"
                            ToolTip="Delete"/>
                    <Button Content="&#xE838;"
                            FontFamily="Segoe MDL2 Assets"
                            Command="{Binding OpenInExplorerCommand}"
                            Padding="8,4"
                            ToolTip="Open in Explorer"/>
                </StackPanel>

                <!-- Open/Cancel Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Browse..."
                            Command="{Binding BrowseFolderCommand}"
                            Padding="16,8"
                            Margin="0,0,8,0"/>
                    <Button Content="Cancel"
                            Click="CancelButton_Click"
                            Padding="16,8"
                            Margin="0,0,8,0"/>
                    <Button Content="Open"
                            Command="{Binding OpenProjectCommand}"
                            IsEnabled="{Binding SelectedProject, Converter={StaticResource NullToBool}}"
                            Padding="16,8"
                            Background="#0078D4"
                            Foreground="White"
                            BorderThickness="0"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
