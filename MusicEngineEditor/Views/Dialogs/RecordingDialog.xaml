<Window x:Class="MusicEngineEditor.Views.Dialogs.RecordingDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewmodels="clr-namespace:MusicEngineEditor.ViewModels"
        xmlns:local="clr-namespace:MusicEngineEditor.Views.Dialogs"
        mc:Ignorable="d"
        Title="Audio Recording"
        Width="650" Height="720"
        MinWidth="550" MinHeight="600"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Background="{DynamicResource BackgroundBrush}"
        Foreground="{DynamicResource ForegroundBrush}"
        d:DataContext="{d:DesignInstance Type=viewmodels:RecordingViewModel, IsDesignTimeCreatable=False}">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <local:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <local:RecordingInverseBooleanConverter x:Key="InverseBooleanConverter"/>

        <!-- Level Meter Style -->
        <Style x:Key="LevelMeterStyle" TargetType="ProgressBar">
            <Setter Property="Height" Value="12"/>
            <Setter Property="Minimum" Value="0"/>
            <Setter Property="Maximum" Value="1"/>
            <Setter Property="Background" Value="{DynamicResource PanelBackgroundBrush}"/>
            <Setter Property="Foreground" Value="#00CC66"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsClipping}" Value="True">
                    <Setter Property="Foreground" Value="#FF4757"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Recording Button Style -->
        <Style x:Key="RecordButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="60"/>
            <Setter Property="Height" Value="60"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Background" Value="{DynamicResource PanelBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="30">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Margin="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" Padding="20">
            <StackPanel>

                <!-- Device Selection Section -->
                <TextBlock Text="Input Device"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,0,0,10"
                           Foreground="{DynamicResource BrightForegroundBrush}"/>

                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <ComboBox ItemsSource="{Binding AvailableDevices}"
                              SelectedItem="{Binding SelectedDevice, Mode=TwoWay}"
                              Background="{DynamicResource EditorBackgroundBrush}"
                              Foreground="{DynamicResource ForegroundBrush}"
                              BorderBrush="{DynamicResource BorderBrush}"
                              Padding="8,6"
                              IsEnabled="{Binding IsRecording, Converter={StaticResource InverseBooleanConverter}}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <Run Text="{Binding Name}"/>
                                    <Run Text=" ("/>
                                    <Run Text="{Binding Channels}"/>
                                    <Run Text="ch)"/>
                                </TextBlock>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    <Button Grid.Column="1"
                            Content="Refresh"
                            Command="{Binding RefreshDevicesCommand}"
                            Padding="15,6"
                            Margin="10,0,0,0"/>
                </Grid>

                <!-- Recording Format Section -->
                <TextBlock Text="Recording Format"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,5,0,10"
                           Foreground="{DynamicResource BrightForegroundBrush}"/>

                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="80"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Sample Rate:" VerticalAlignment="Center"/>
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding SampleRates}"
                              SelectedItem="{Binding SelectedSampleRate, Mode=TwoWay}"
                              Background="{DynamicResource EditorBackgroundBrush}"
                              Foreground="{DynamicResource ForegroundBrush}"
                              BorderBrush="{DynamicResource BorderBrush}"
                              IsEnabled="{Binding IsRecording, Converter={StaticResource InverseBooleanConverter}}"
                              Margin="0,0,15,0">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <Run Text="{Binding Mode=OneWay}"/>
                                    <Run Text=" Hz"/>
                                </TextBlock>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <TextBlock Grid.Column="2" Text="Bit Depth:" VerticalAlignment="Center"/>
                    <ComboBox Grid.Column="3"
                              ItemsSource="{Binding BitDepths}"
                              SelectedItem="{Binding SelectedBitDepth, Mode=TwoWay}"
                              Background="{DynamicResource EditorBackgroundBrush}"
                              Foreground="{DynamicResource ForegroundBrush}"
                              BorderBrush="{DynamicResource BorderBrush}"
                              IsEnabled="{Binding IsRecording, Converter={StaticResource InverseBooleanConverter}}"
                              Margin="0,0,15,0"/>

                    <TextBlock Grid.Column="4" Text="Channels:" VerticalAlignment="Center"/>
                    <ComboBox Grid.Column="5"
                              ItemsSource="{Binding ChannelOptions}"
                              SelectedItem="{Binding SelectedChannels, Mode=TwoWay}"
                              Background="{DynamicResource EditorBackgroundBrush}"
                              Foreground="{DynamicResource ForegroundBrush}"
                              BorderBrush="{DynamicResource BorderBrush}"
                              IsEnabled="{Binding IsRecording, Converter={StaticResource InverseBooleanConverter}}"/>
                </Grid>

                <Separator Background="{DynamicResource BorderBrush}" Margin="0,5,0,20"/>

                <!-- Level Meters Section -->
                <TextBlock Text="Input Levels"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,0,0,10"
                           Foreground="{DynamicResource BrightForegroundBrush}"/>

                <Grid Margin="0,0,0,10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="60"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="L" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    <ProgressBar Grid.Column="1"
                                 Value="{Binding LeftLevel, Mode=OneWay}"
                                 Style="{StaticResource LevelMeterStyle}"
                                 Margin="5,0"/>
                    <TextBlock Grid.Column="2"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Right">
                        <Run Text="{Binding LeftPeakDb, StringFormat={}{0:F1}}"/>
                        <Run Text=" dB"/>
                    </TextBlock>

                    <TextBlock Grid.Row="1" Text="R" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                    <ProgressBar Grid.Row="1" Grid.Column="1"
                                 Value="{Binding RightLevel, Mode=OneWay}"
                                 Style="{StaticResource LevelMeterStyle}"
                                 Margin="5,5,5,0"/>
                    <TextBlock Grid.Row="1" Grid.Column="2"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Right"
                               Margin="0,5,0,0">
                        <Run Text="{Binding RightPeakDb, StringFormat={}{0:F1}}"/>
                        <Run Text=" dB"/>
                    </TextBlock>
                </Grid>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                    <TextBlock Text="Clipping!"
                               Foreground="#FF4757"
                               FontWeight="Bold"
                               Visibility="{Binding IsClipping, Converter={StaticResource BoolToVisibilityConverter}}"
                               Margin="0,0,15,0"/>
                    <Button Content="Reset Peaks"
                            Command="{Binding ResetPeaksCommand}"
                            Padding="10,4"/>
                </StackPanel>

                <Separator Background="{DynamicResource BorderBrush}" Margin="0,5,0,20"/>

                <!-- Monitoring Section -->
                <TextBlock Text="Monitoring"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,0,0,10"
                           Foreground="{DynamicResource BrightForegroundBrush}"/>

                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <ToggleButton Content="Monitor"
                                  IsChecked="{Binding IsMonitoring, Mode=TwoWay}"
                                  Command="{Binding ToggleMonitoringCommand}"
                                  Padding="15,8"
                                  Margin="0,0,20,0"/>

                    <TextBlock Grid.Column="1" Text="Volume:" VerticalAlignment="Center"/>
                    <Slider Grid.Column="2"
                            Value="{Binding MonitoringVolume, Mode=TwoWay}"
                            Minimum="0" Maximum="2"
                            VerticalAlignment="Center"
                            Margin="5,0,20,0"/>

                    <TextBlock Grid.Column="3" Text="Pan:" VerticalAlignment="Center"/>
                    <Slider Grid.Column="4"
                            Value="{Binding MonitoringPan, Mode=TwoWay}"
                            Minimum="-1" Maximum="1"
                            VerticalAlignment="Center"
                            Margin="5,0,0,0"/>
                </Grid>

                <Separator Background="{DynamicResource BorderBrush}" Margin="0,5,0,20"/>

                <!-- Punch-In/Out Section -->
                <TextBlock Text="Punch-In/Out"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,0,0,10"
                           Foreground="{DynamicResource BrightForegroundBrush}"/>

                <CheckBox Content="Enable Punch-In/Out"
                          IsChecked="{Binding PunchEnabled, Mode=TwoWay}"
                          Margin="0,0,0,10"/>

                <Grid Margin="0,0,0,15" IsEnabled="{Binding PunchEnabled}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Punch In:" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="1"
                             Text="{Binding PunchInTimeText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Background="{DynamicResource EditorBackgroundBrush}"
                             Foreground="{DynamicResource ForegroundBrush}"
                             BorderBrush="{DynamicResource BorderBrush}"
                             Padding="8,6"
                             Margin="0,0,5,0"/>
                    <Button Grid.Column="2"
                            Content="Set"
                            Command="{Binding SetPunchInTimeCommand}"
                            Padding="10,6"
                            Margin="0,0,20,0"/>

                    <TextBlock Grid.Column="3" Text="Punch Out:" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="4"
                             Text="{Binding PunchOutTimeText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Background="{DynamicResource EditorBackgroundBrush}"
                             Foreground="{DynamicResource ForegroundBrush}"
                             BorderBrush="{DynamicResource BorderBrush}"
                             Padding="8,6"
                             Margin="0,0,5,0"/>
                    <Button Grid.Column="5"
                            Content="Set"
                            Command="{Binding SetPunchOutTimeCommand}"
                            Padding="10,6"/>
                </Grid>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <Button Content="Manual Punch In"
                            Command="{Binding ManualPunchInCommand}"
                            Padding="15,8"
                            Margin="0,0,10,0"
                            IsEnabled="{Binding IsRecording}"/>
                    <Button Content="Manual Punch Out"
                            Command="{Binding ManualPunchOutCommand}"
                            Padding="15,8"
                            IsEnabled="{Binding IsRecording}"/>
                    <TextBlock Text="Punched In"
                               Foreground="#00CC66"
                               FontWeight="Bold"
                               VerticalAlignment="Center"
                               Margin="20,0,0,0"
                               Visibility="{Binding IsPunchedIn, Converter={StaticResource BoolToVisibilityConverter}}"/>
                </StackPanel>

                <Separator Background="{DynamicResource BorderBrush}" Margin="0,15,0,20"/>

                <!-- Output Settings Section -->
                <TextBlock Text="Output"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,0,0,10"
                           Foreground="{DynamicResource BrightForegroundBrush}"/>

                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Directory:" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="1"
                             Text="{Binding OutputPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Background="{DynamicResource EditorBackgroundBrush}"
                             Foreground="{DynamicResource ForegroundBrush}"
                             BorderBrush="{DynamicResource BorderBrush}"
                             Padding="8,6"/>
                    <Button Grid.Column="2"
                            Content="Browse..."
                            Command="{Binding BrowseOutputPathCommand}"
                            Padding="15,6"
                            Margin="10,0,0,0"/>
                </Grid>

                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Filename:" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="1"
                             Text="{Binding OutputFileName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Background="{DynamicResource EditorBackgroundBrush}"
                             Foreground="{DynamicResource ForegroundBrush}"
                             BorderBrush="{DynamicResource BorderBrush}"
                             Padding="8,6"/>
                    <CheckBox Grid.Column="2"
                              Content="Add Timestamp"
                              IsChecked="{Binding AppendTimestamp, Mode=TwoWay}"
                              VerticalAlignment="Center"
                              Margin="15,0,0,0"/>
                </Grid>

                <Separator Background="{DynamicResource BorderBrush}" Margin="0,15,0,20"/>

                <!-- Recording Controls Section -->
                <TextBlock Text="Recording"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,0,0,15"
                           Foreground="{DynamicResource BrightForegroundBrush}"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal">
                        <!-- Arm Button -->
                        <Button Style="{StaticResource RecordButtonStyle}"
                                Command="{Binding ToggleArmCommand}"
                                ToolTip="Arm/Disarm Recording">
                            <Button.Background>
                                <SolidColorBrush Color="{Binding IsArmed, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#FF5722|#424242}"/>
                            </Button.Background>
                            <Ellipse Width="20" Height="20" Fill="White"/>
                        </Button>

                        <!-- Record Button -->
                        <Button Style="{StaticResource RecordButtonStyle}"
                                Command="{Binding ToggleRecordingCommand}"
                                ToolTip="Start/Stop Recording">
                            <Button.Background>
                                <SolidColorBrush Color="{Binding IsRecording, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#FF4757|#424242}"/>
                            </Button.Background>
                            <Ellipse Width="24" Height="24" Fill="#FF4757"/>
                        </Button>

                        <!-- Pause Button -->
                        <Button Style="{StaticResource RecordButtonStyle}"
                                Command="{Binding TogglePauseCommand}"
                                IsEnabled="{Binding IsRecording}"
                                ToolTip="Pause/Resume Recording">
                            <Button.Background>
                                <SolidColorBrush Color="{Binding IsPaused, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#FFC107|#424242}"/>
                            </Button.Background>
                            <StackPanel Orientation="Horizontal">
                                <Rectangle Width="6" Height="20" Fill="White" Margin="0,0,4,0"/>
                                <Rectangle Width="6" Height="20" Fill="White"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="20,0,0,0">
                        <TextBlock FontSize="28"
                                   FontWeight="Bold"
                                   FontFamily="Consolas"
                                   Text="{Binding RecordingDuration}"/>
                        <TextBlock FontSize="14"
                                   Foreground="{DynamicResource SecondaryForegroundBrush}"
                                   Text="{Binding RecordingStatus}"/>
                    </StackPanel>
                </Grid>

            </StackPanel>
        </ScrollViewer>

        <!-- Bottom Button Panel -->
        <Border Grid.Row="1"
                Background="{DynamicResource PanelBackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="20,15">
            <Grid>
                <Button Content="Open Output Folder"
                        Command="{Binding OpenOutputFolderCommand}"
                        HorizontalAlignment="Left"
                        Padding="15,8"/>

                <Button Content="Close"
                        Command="{Binding CloseCommand}"
                        HorizontalAlignment="Right"
                        Padding="20,8"/>
            </Grid>
        </Border>
    </Grid>
</Window>
