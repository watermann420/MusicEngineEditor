<UserControl x:Class="MusicEngineEditor.Controls.InputDeviceSelector"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:MusicEngineEditor.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="70" d:DesignWidth="250"
             Background="Transparent">

    <UserControl.Resources>
        <!-- Colors -->
        <Color x:Key="ControlBackgroundColor">#1A1A1A</Color>
        <Color x:Key="BorderColor">#393B40</Color>
        <Color x:Key="TextPrimaryColor">#BCBEC4</Color>
        <Color x:Key="TextSecondaryColor">#6F737A</Color>
        <Color x:Key="AccentColor">#4B6EAF</Color>
        <Color x:Key="HoverColor">#3C3F44</Color>

        <!-- Brushes -->
        <SolidColorBrush x:Key="ControlBackgroundBrush" Color="{StaticResource ControlBackgroundColor}"/>
        <SolidColorBrush x:Key="BorderBrush" Color="{StaticResource BorderColor}"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="{StaticResource TextPrimaryColor}"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="{StaticResource TextSecondaryColor}"/>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>
        <SolidColorBrush x:Key="HoverBrush" Color="{StaticResource HoverColor}"/>

        <!-- ComboBox Style -->
        <Style x:Key="DeviceComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="ItemTemplate">
                <Setter.Value>
                    <DataTemplate DataType="{x:Type vm:InputDeviceInfo}">
                        <TextBlock Text="{Binding DisplayName}" TextTrimming="CharacterEllipsis"/>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Small Refresh Button Style -->
        <Style x:Key="RefreshButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="ToolTip" Value="Refresh device list"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <Path x:Name="icon"
                                  Data="M 8,4 A 4,4 0 1 1 4,8 M 8,4 L 10,2 M 8,4 L 10,6"
                                  Stroke="{TemplateBinding Foreground}"
                                  StrokeThickness="1.5"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  RenderTransformOrigin="0.5,0.5">
                                <Path.RenderTransform>
                                    <RotateTransform x:Name="iconRotation" Angle="0"/>
                                </Path.RenderTransform>
                            </Path>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource HoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <StackPanel>
        <!-- Device Dropdown with Refresh -->
        <Grid Margin="0,0,0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <ComboBox x:Name="DeviceComboBox"
                      Grid.Column="0"
                      Style="{StaticResource DeviceComboBoxStyle}"
                      ItemsSource="{Binding AvailableDevices, RelativeSource={RelativeSource AncestorType=UserControl}}"
                      SelectedItem="{Binding SelectedDevice, RelativeSource={RelativeSource AncestorType=UserControl}, Mode=TwoWay}"
                      DisplayMemberPath="DisplayName"/>

            <Button x:Name="RefreshButton"
                    Grid.Column="2"
                    Style="{StaticResource RefreshButtonStyle}"
                    Command="{Binding RefreshCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Click="RefreshButton_Click"/>
        </Grid>

        <!-- Device Info -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Sample Rate -->
            <StackPanel Grid.Column="0" Orientation="Horizontal">
                <TextBlock Text="Rate: "
                           FontSize="10"
                           Foreground="{StaticResource TextSecondaryBrush}"/>
                <TextBlock x:Name="SampleRateText"
                           FontSize="10"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           FontFamily="Consolas"
                           Text="{Binding SampleRate, RelativeSource={RelativeSource AncestorType=UserControl}, StringFormat={}{0} Hz}"/>
            </StackPanel>

            <!-- Channel Count -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                <TextBlock Text="Channels: "
                           FontSize="10"
                           Foreground="{StaticResource TextSecondaryBrush}"/>
                <TextBlock x:Name="ChannelCountText"
                           FontSize="10"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           FontFamily="Consolas"
                           Text="{Binding ChannelCount, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
            </StackPanel>
        </Grid>
    </StackPanel>
</UserControl>
