<UserControl x:Class="MusicEngineEditor.Controls.PdcDisplayControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:MusicEngineEditor.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="60" d:DesignWidth="200"
             d:DataContext="{d:DesignInstance Type=vm:PdcDisplayViewModel}"
             Background="#1E1F22">

    <UserControl.Resources>
        <!-- Colors -->
        <Color x:Key="PanelBackgroundColor">#252629</Color>
        <Color x:Key="BorderColor">#393B40</Color>
        <Color x:Key="TextPrimaryColor">#BCBEC4</Color>
        <Color x:Key="TextSecondaryColor">#6F737A</Color>
        <Color x:Key="CompensatedColor">#6AAB73</Color>
        <Color x:Key="UncompensatedColor">#F75464</Color>
        <Color x:Key="WarningColor">#E8B339</Color>
        <Color x:Key="AccentColor">#4B6EAF</Color>
        <Color x:Key="DisabledColor">#5C5F66</Color>

        <!-- Brushes -->
        <SolidColorBrush x:Key="PanelBackgroundBrush" Color="{StaticResource PanelBackgroundColor}"/>
        <SolidColorBrush x:Key="BorderBrush" Color="{StaticResource BorderColor}"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="{StaticResource TextPrimaryColor}"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="{StaticResource TextSecondaryColor}"/>
        <SolidColorBrush x:Key="CompensatedBrush" Color="{StaticResource CompensatedColor}"/>
        <SolidColorBrush x:Key="UncompensatedBrush" Color="{StaticResource UncompensatedColor}"/>
        <SolidColorBrush x:Key="WarningBrush" Color="{StaticResource WarningColor}"/>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>
        <SolidColorBrush x:Key="DisabledBrush" Color="{StaticResource DisabledColor}"/>

        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- PDC Toggle Button Style -->
        <Style x:Key="PdcToggleStyle" TargetType="ToggleButton">
            <Setter Property="Width" Value="36"/>
            <Setter Property="Height" Value="18"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Grid>
                            <Border x:Name="Background"
                                    Background="{StaticResource DisabledBrush}"
                                    CornerRadius="9"
                                    BorderThickness="0"/>
                            <Border x:Name="Thumb"
                                    Width="14" Height="14"
                                    Background="White"
                                    CornerRadius="7"
                                    HorizontalAlignment="Left"
                                    Margin="2,0,0,0">
                                <Border.RenderTransform>
                                    <TranslateTransform x:Name="ThumbTransform" X="0"/>
                                </Border.RenderTransform>
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Background" Property="Background" Value="{StaticResource CompensatedBrush}"/>
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="ThumbTransform"
                                                             Storyboard.TargetProperty="X"
                                                             To="18" Duration="0:0:0.1"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="ThumbTransform"
                                                             Storyboard.TargetProperty="X"
                                                             To="0" Duration="0:0:0.1"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Border Background="{StaticResource PanelBackgroundBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Padding="8,6">

        <Border.ToolTip>
            <ToolTip MaxWidth="400">
                <StackPanel>
                    <TextBlock Text="Plugin Delay Compensation (PDC)"
                               FontWeight="SemiBold"
                               Margin="0,0,0,8"/>
                    <TextBlock Text="{Binding DetailedBreakdown}"
                               FontFamily="Consolas"
                               FontSize="11"
                               TextWrapping="Wrap"/>
                </StackPanel>
            </ToolTip>
        </Border.ToolTip>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Status Indicator -->
            <Border Grid.Column="0"
                    Width="8" Height="8"
                    CornerRadius="4"
                    Margin="0,0,8,0"
                    VerticalAlignment="Center">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="{StaticResource DisabledBrush}"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsCompensationActive}" Value="True">
                                <Setter Property="Background" Value="{StaticResource CompensatedBrush}"/>
                            </DataTrigger>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding IsPdcEnabled}" Value="True"/>
                                    <Condition Binding="{Binding TotalLatencySamples}" Value="0"/>
                                </MultiDataTrigger.Conditions>
                                <Setter Property="Background" Value="{StaticResource TextSecondaryBrush}"/>
                            </MultiDataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
            </Border>

            <!-- Latency Info -->
            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                <TextBlock Text="PDC"
                           FontSize="9"
                           FontWeight="SemiBold"
                           Foreground="{StaticResource TextSecondaryBrush}"/>
                <TextBlock FontSize="11"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           FontFamily="Consolas">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Text" Value="{Binding StatusText}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsPdcEnabled}" Value="False">
                                    <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </StackPanel>

            <!-- Toggle Switch -->
            <ToggleButton Grid.Column="2"
                          Style="{StaticResource PdcToggleStyle}"
                          IsChecked="{Binding IsPdcEnabled, Mode=TwoWay}"
                          Command="{Binding TogglePdcCommand}"
                          ToolTip="Enable/Disable PDC"
                          VerticalAlignment="Center"/>
        </Grid>
    </Border>
</UserControl>
