<UserControl x:Class="MusicEngineEditor.Controls.SlipEditControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="80" d:DesignWidth="400"
             ClipToBounds="True"
             Background="Transparent">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <!-- Slip edit colors -->
        <SolidColorBrush x:Key="SlipBackgroundBrush" Color="#40000000"/>
        <SolidColorBrush x:Key="SlipWaveformBrush" Color="#60FFFFFF"/>
        <SolidColorBrush x:Key="ActiveWaveformBrush" Color="#FFFFFFFF"/>
        <SolidColorBrush x:Key="BoundaryBrush" Color="#FF4CAF50"/>
        <SolidColorBrush x:Key="SlipHandleBrush" Color="#FFFFC107"/>

        <!-- Handle style -->
        <Style x:Key="SlipHandleStyle" TargetType="Border">
            <Setter Property="Width" Value="8"/>
            <Setter Property="Background" Value="{StaticResource SlipHandleBrush}"/>
            <Setter Property="Cursor" Value="SizeWE"/>
            <Setter Property="Opacity" Value="0.8"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="1"/>
                    <Setter Property="Width" Value="10"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid x:Name="RootGrid">
        <!-- Full audio waveform (outside clip boundaries) -->
        <Canvas x:Name="FullWaveformCanvas"
                Background="{StaticResource SlipBackgroundBrush}"
                ClipToBounds="True">

            <!-- Full waveform path (dimmed) -->
            <Path x:Name="FullWaveformPath"
                  Fill="{StaticResource SlipWaveformBrush}"
                  Opacity="0.5"/>

            <!-- Active region waveform (bright) -->
            <Path x:Name="ActiveWaveformPath"
                  Fill="{StaticResource ActiveWaveformBrush}"
                  Opacity="0.8"/>

            <!-- Left boundary line -->
            <Line x:Name="LeftBoundaryLine"
                  Stroke="{StaticResource BoundaryBrush}"
                  StrokeThickness="2"
                  StrokeDashArray="4,2"
                  Y1="0"/>

            <!-- Right boundary line -->
            <Line x:Name="RightBoundaryLine"
                  Stroke="{StaticResource BoundaryBrush}"
                  StrokeThickness="2"
                  StrokeDashArray="4,2"
                  Y1="0"/>

            <!-- Left dimmed overlay -->
            <Rectangle x:Name="LeftOverlay"
                       Fill="#80000000"
                       IsHitTestVisible="False"/>

            <!-- Right dimmed overlay -->
            <Rectangle x:Name="RightOverlay"
                       Fill="#80000000"
                       IsHitTestVisible="False"/>
        </Canvas>

        <!-- Slip indicator -->
        <Border x:Name="SlipIndicator"
                Background="#E0FFC107"
                CornerRadius="2"
                Padding="6,2"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Margin="0,4,0,0"
                Visibility="Collapsed">
            <TextBlock x:Name="SlipAmountText"
                       Text="+0.00"
                       FontSize="10"
                       FontWeight="SemiBold"
                       Foreground="#000000"/>
        </Border>

        <!-- Snap indicator -->
        <Border x:Name="SnapIndicator"
                Background="#E04CAF50"
                CornerRadius="2"
                Padding="4,2"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="0,4,8,0"
                Visibility="{Binding IsSnapEnabled, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVisibilityConverter}}">
            <TextBlock Text="SNAP"
                       FontSize="9"
                       FontWeight="Bold"
                       Foreground="White"/>
        </Border>

        <!-- Mode indicator -->
        <Border x:Name="ModeIndicator"
                Background="#E02196F3"
                CornerRadius="2"
                Padding="4,2"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Margin="8,4,0,0">
            <TextBlock Text="SLIP EDIT"
                       FontSize="9"
                       FontWeight="Bold"
                       Foreground="White"/>
        </Border>

        <!-- Instructions overlay (shown when first entering slip mode) -->
        <Border x:Name="InstructionsOverlay"
                Background="#C0000000"
                Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="Slip Edit Mode"
                           FontSize="14"
                           FontWeight="Bold"
                           Foreground="White"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,8"/>
                <TextBlock Text="Drag to slip audio left/right within clip boundaries"
                           FontSize="11"
                           Foreground="#CCCCCC"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,4"/>
                <TextBlock Text="Hold Ctrl for fine adjustment"
                           FontSize="11"
                           Foreground="#CCCCCC"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,4"/>
                <TextBlock Text="Press Escape to exit"
                           FontSize="11"
                           Foreground="#CCCCCC"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
