<UserControl x:Class="MusicEngineEditor.Controls.AudioClipControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:MusicEngineEditor.Controls"
             mc:Ignorable="d"
             d:DesignHeight="60" d:DesignWidth="200"
             ClipToBounds="True"
             Cursor="Hand">

    <UserControl.Resources>
        <!-- Audio Clip Colors -->
        <Color x:Key="AudioClipColor">#4CAF50</Color>
        <Color x:Key="AudioClipFillColor">#B04CAF50</Color>
        <SolidColorBrush x:Key="AudioClipBrush" Color="{StaticResource AudioClipColor}"/>
        <SolidColorBrush x:Key="AudioClipFillBrush" Color="{StaticResource AudioClipFillColor}"/>
        <SolidColorBrush x:Key="WaveformBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="FadeCurveBrush" Color="#80FFFFFF"/>
        <SolidColorBrush x:Key="GainIndicatorBrush" Color="#FFC107"/>

        <!-- Clip Border Style -->
        <Style x:Key="AudioClipBorderStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="4" ShadowDepth="1" Opacity="0.2" Color="#000000"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Resize Handle Style -->
        <Style x:Key="ResizeHandleStyle" TargetType="Border">
            <Setter Property="Width" Value="6"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Cursor" Value="SizeWE"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#40FFFFFF"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Fade Handle Style -->
        <Style x:Key="FadeHandleStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="10"/>
            <Setter Property="Height" Value="10"/>
            <Setter Property="Fill" Value="#80FFFFFF"/>
            <Setter Property="Stroke" Value="#FFFFFF"/>
            <Setter Property="StrokeThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Fill" Value="#FFFFFF"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid x:Name="RootGrid">
        <!-- Main Clip Border -->
        <Border x:Name="ClipBorder"
                Style="{StaticResource AudioClipBorderStyle}"
                Background="{StaticResource AudioClipFillBrush}"
                BorderBrush="{StaticResource AudioClipBrush}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header Bar -->
                <Border x:Name="HeaderBar"
                        Grid.Row="0"
                        Background="{StaticResource AudioClipBrush}"
                        CornerRadius="4,4,0,0"
                        Padding="4,2">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Audio Icon -->
                        <TextBlock Grid.Column="0"
                                   Text="~"
                                   FontSize="10"
                                   FontWeight="Bold"
                                   Foreground="White"
                                   VerticalAlignment="Center"
                                   Margin="0,0,4,0"
                                   ToolTip="Audio Clip"/>

                        <!-- Clip Name -->
                        <TextBlock x:Name="ClipNameText"
                                   Grid.Column="1"
                                   FontSize="10"
                                   FontWeight="SemiBold"
                                   Foreground="White"
                                   VerticalAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>

                        <!-- Gain Indicator -->
                        <StackPanel x:Name="GainIndicator"
                                    Grid.Column="2"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Visibility="Collapsed">
                            <TextBlock x:Name="GainText"
                                       FontSize="9"
                                       Foreground="{StaticResource GainIndicatorBrush}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Waveform Area -->
                <Canvas x:Name="WaveformCanvas"
                        Grid.Row="1"
                        Background="Transparent"
                        ClipToBounds="True">

                    <!-- Fade In Curve -->
                    <Path x:Name="FadeInPath"
                          Fill="#40000000"
                          Stroke="{StaticResource FadeCurveBrush}"
                          StrokeThickness="1"
                          Visibility="Collapsed"/>

                    <!-- Fade Out Curve -->
                    <Path x:Name="FadeOutPath"
                          Fill="#40000000"
                          Stroke="{StaticResource FadeCurveBrush}"
                          StrokeThickness="1"
                          Visibility="Collapsed"/>

                    <!-- Waveform Path -->
                    <Path x:Name="WaveformPath"
                          Fill="{StaticResource WaveformBrush}"
                          Opacity="0.7"/>

                    <!-- Center Line -->
                    <Line x:Name="CenterLine"
                          Stroke="#30FFFFFF"
                          StrokeThickness="1"
                          IsHitTestVisible="False"/>
                </Canvas>

                <!-- Muted Overlay -->
                <Border x:Name="MutedOverlay"
                        Grid.Row="0"
                        Grid.RowSpan="2"
                        Background="#60000000"
                        CornerRadius="4"
                        Visibility="Collapsed"
                        IsHitTestVisible="False">
                    <TextBlock Text="MUTED"
                               FontSize="10"
                               FontWeight="Bold"
                               Foreground="#80FFFFFF"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                </Border>

                <!-- Selection Highlight -->
                <Border x:Name="SelectionBorder"
                        Grid.Row="0"
                        Grid.RowSpan="2"
                        BorderBrush="{DynamicResource AccentBrush}"
                        BorderThickness="2"
                        CornerRadius="4"
                        Visibility="Collapsed"
                        IsHitTestVisible="False"/>
            </Grid>
        </Border>

        <!-- Left Resize Handle -->
        <Border x:Name="LeftResizeHandle"
                Style="{StaticResource ResizeHandleStyle}"
                HorizontalAlignment="Left"
                VerticalAlignment="Stretch"
                MouseLeftButtonDown="LeftResizeHandle_MouseDown"/>

        <!-- Right Resize Handle -->
        <Border x:Name="RightResizeHandle"
                Style="{StaticResource ResizeHandleStyle}"
                HorizontalAlignment="Right"
                VerticalAlignment="Stretch"
                MouseLeftButtonDown="RightResizeHandle_MouseDown"/>

        <!-- Fade In Handle (top-left corner) -->
        <Ellipse x:Name="FadeInHandle"
                 Style="{StaticResource FadeHandleStyle}"
                 HorizontalAlignment="Left"
                 VerticalAlignment="Top"
                 Margin="12,24,0,0"
                 MouseLeftButtonDown="FadeInHandle_MouseDown"
                 ToolTip="Drag to adjust fade-in"
                 Visibility="Collapsed"/>

        <!-- Fade Out Handle (top-right corner) -->
        <Ellipse x:Name="FadeOutHandle"
                 Style="{StaticResource FadeHandleStyle}"
                 HorizontalAlignment="Right"
                 VerticalAlignment="Top"
                 Margin="0,24,12,0"
                 MouseLeftButtonDown="FadeOutHandle_MouseDown"
                 ToolTip="Drag to adjust fade-out"
                 Visibility="Collapsed"/>

        <!-- Context Menu -->
        <Grid.ContextMenu>
            <ContextMenu x:Name="AudioClipContextMenu">
                <MenuItem Header="Edit in Audio Editor" Click="EditMenuItem_Click" InputGestureText="E"/>
                <Separator/>
                <MenuItem Header="Split at Playhead" Click="SplitMenuItem_Click" InputGestureText="S"/>
                <MenuItem Header="Duplicate" Click="DuplicateMenuItem_Click" InputGestureText="Ctrl+D"/>
                <MenuItem Header="Bounce to New Clip" Click="BounceMenuItem_Click" ToolTip="Render audio with all effects applied"/>
                <Separator/>
                <MenuItem Header="Fade In">
                    <MenuItem Header="None" Tag="0" Click="SetFadeIn_Click"/>
                    <MenuItem Header="Short (0.25 beats)" Tag="0.25" Click="SetFadeIn_Click"/>
                    <MenuItem Header="Medium (0.5 beats)" Tag="0.5" Click="SetFadeIn_Click"/>
                    <MenuItem Header="Long (1 beat)" Tag="1" Click="SetFadeIn_Click"/>
                    <MenuItem Header="Very Long (2 beats)" Tag="2" Click="SetFadeIn_Click"/>
                </MenuItem>
                <MenuItem Header="Fade Out">
                    <MenuItem Header="None" Tag="0" Click="SetFadeOut_Click"/>
                    <MenuItem Header="Short (0.25 beats)" Tag="0.25" Click="SetFadeOut_Click"/>
                    <MenuItem Header="Medium (0.5 beats)" Tag="0.5" Click="SetFadeOut_Click"/>
                    <MenuItem Header="Long (1 beat)" Tag="1" Click="SetFadeOut_Click"/>
                    <MenuItem Header="Very Long (2 beats)" Tag="2" Click="SetFadeOut_Click"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="Normalize" Click="NormalizeMenuItem_Click" ToolTip="Normalize to 0 dB"/>
                <MenuItem Header="Reverse" Click="ReverseMenuItem_Click" ToolTip="Toggle reverse playback"/>
                <Separator/>
                <MenuItem x:Name="MuteMenuItem" Header="Mute" Click="MuteMenuItem_Click"/>
                <MenuItem x:Name="LockMenuItem" Header="Lock" Click="LockMenuItem_Click"/>
                <Separator/>
                <MenuItem Header="Delete" Click="DeleteMenuItem_Click" InputGestureText="Del"/>
            </ContextMenu>
        </Grid.ContextMenu>
    </Grid>
</UserControl>
