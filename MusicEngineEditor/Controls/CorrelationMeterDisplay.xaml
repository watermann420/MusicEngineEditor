<UserControl x:Class="MusicEngineEditor.Controls.CorrelationMeterDisplay"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="50" d:DesignWidth="300"
             Background="#1E1F22"
             MinHeight="40"
             MinWidth="150">

    <UserControl.Resources>
        <!-- Dark theme colors -->
        <Color x:Key="BackgroundColor">#1E1F22</Color>
        <Color x:Key="TrackColor">#0D0D0D</Color>
        <Color x:Key="BorderColor">#393B40</Color>
        <Color x:Key="TextColor">#6F737A</Color>
        <Color x:Key="ValueTextColor">#BCBEC4</Color>
        <Color x:Key="CenterColor">#00FF00</Color>
        <Color x:Key="WarningColor">#FFFF00</Color>
        <Color x:Key="DangerColor">#FF3333</Color>
        <Color x:Key="PeakColor">#FFFFFF</Color>

        <!-- Brushes -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="{StaticResource BackgroundColor}"/>
        <SolidColorBrush x:Key="TrackBrush" Color="{StaticResource TrackColor}"/>
        <SolidColorBrush x:Key="BorderBrush" Color="{StaticResource BorderColor}"/>
        <SolidColorBrush x:Key="TextBrush" Color="{StaticResource TextColor}"/>
        <SolidColorBrush x:Key="ValueTextBrush" Color="{StaticResource ValueTextColor}"/>
        <SolidColorBrush x:Key="PeakBrush" Color="{StaticResource PeakColor}"/>

        <!-- Correlation gradient (red at -1, green at 0, cyan at +1) -->
        <LinearGradientBrush x:Key="CorrelationGradientBrush" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="#FF3333" Offset="0.0"/>
            <GradientStop Color="#FF6600" Offset="0.2"/>
            <GradientStop Color="#FFFF00" Offset="0.4"/>
            <GradientStop Color="#00FF00" Offset="0.5"/>
            <GradientStop Color="#00FFAA" Offset="0.7"/>
            <GradientStop Color="#00FFFF" Offset="1.0"/>
        </LinearGradientBrush>
    </UserControl.Resources>

    <Grid Margin="4">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Scale labels -->
        <Grid Grid.Row="0" Margin="0,0,0,2">
            <TextBlock Text="-1" Foreground="{StaticResource TextBrush}" FontSize="9"
                       HorizontalAlignment="Left"/>
            <TextBlock Text="0" Foreground="{StaticResource TextBrush}" FontSize="9"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="+1" Foreground="{StaticResource TextBrush}" FontSize="9"
                       HorizontalAlignment="Right"/>
        </Grid>

        <!-- Meter track -->
        <Border Grid.Row="1"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="2"
                Background="{StaticResource TrackBrush}"
                Height="16">
            <Grid>
                <!-- Gradient background showing the scale -->
                <Rectangle Margin="2"
                           RadiusX="1" RadiusY="1"
                           Opacity="0.3"
                           Fill="{StaticResource CorrelationGradientBrush}"/>

                <!-- Center line marker -->
                <Rectangle Width="2" Height="20"
                           Fill="{StaticResource BorderBrush}"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>

                <!-- Indicator bar (positioned based on correlation) -->
                <Canvas x:Name="IndicatorCanvas" ClipToBounds="True" Margin="2">
                    <Rectangle x:Name="IndicatorBar"
                               Width="4" Height="12"
                               Fill="{StaticResource CenterColor}"
                               RadiusX="2" RadiusY="2"
                               Canvas.Top="0"/>

                    <!-- Peak hold indicator -->
                    <Rectangle x:Name="PeakIndicator"
                               Width="2" Height="12"
                               Fill="{StaticResource PeakBrush}"
                               Canvas.Top="0"
                               Visibility="Collapsed"/>
                </Canvas>
            </Grid>
        </Border>

        <!-- Value display and M/S ratio -->
        <Grid Grid.Row="2" Margin="0,4,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Correlation value -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left">
                <TextBlock Text="Corr: " Foreground="{StaticResource TextBrush}" FontSize="10"/>
                <TextBlock x:Name="CorrelationValueText"
                           Text="0.00"
                           Foreground="{StaticResource ValueTextBrush}"
                           FontSize="10"
                           FontWeight="SemiBold"
                           MinWidth="36"/>
            </StackPanel>

            <!-- Phase indicator -->
            <TextBlock x:Name="PhaseIndicatorText"
                       Grid.Column="1"
                       Text="IN PHASE"
                       Foreground="{StaticResource CenterColor}"
                       FontSize="9"
                       FontWeight="Bold"
                       HorizontalAlignment="Center"/>

            <!-- M/S Ratio -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                <TextBlock Text="M/S: " Foreground="{StaticResource TextBrush}" FontSize="10"/>
                <TextBlock x:Name="MsRatioText"
                           Text="50/50"
                           Foreground="{StaticResource ValueTextBrush}"
                           FontSize="10"
                           FontWeight="SemiBold"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
