<UserControl x:Class="MusicEngineEditor.Controls.TruePeakMeter"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="200" d:DesignWidth="80"
             Background="#1E1F22"
             MinHeight="100"
             MinWidth="50">

    <UserControl.Resources>
        <!-- Dark theme colors -->
        <Color x:Key="BackgroundColor">#1E1F22</Color>
        <Color x:Key="TrackColor">#0D0D0D</Color>
        <Color x:Key="BorderColor">#393B40</Color>
        <Color x:Key="TextColor">#6F737A</Color>
        <Color x:Key="ValueTextColor">#BCBEC4</Color>
        <Color x:Key="ClipColor">#FF3333</Color>
        <Color x:Key="ClipOffColor">#4D1A1A</Color>
        <Color x:Key="PeakColor">#FFFFFF</Color>

        <!-- Meter gradient colors -->
        <Color x:Key="MeterGreenColor">#00FF00</Color>
        <Color x:Key="MeterYellowColor">#FFFF00</Color>
        <Color x:Key="MeterOrangeColor">#FF8800</Color>
        <Color x:Key="MeterRedColor">#FF0000</Color>

        <!-- Brushes -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="{StaticResource BackgroundColor}"/>
        <SolidColorBrush x:Key="TrackBrush" Color="{StaticResource TrackColor}"/>
        <SolidColorBrush x:Key="BorderBrush" Color="{StaticResource BorderColor}"/>
        <SolidColorBrush x:Key="TextBrush" Color="{StaticResource TextColor}"/>
        <SolidColorBrush x:Key="ValueTextBrush" Color="{StaticResource ValueTextColor}"/>
        <SolidColorBrush x:Key="ClipBrush" Color="{StaticResource ClipColor}"/>
        <SolidColorBrush x:Key="ClipOffBrush" Color="{StaticResource ClipOffColor}"/>
        <SolidColorBrush x:Key="PeakBrush" Color="{StaticResource PeakColor}"/>

        <!-- Level gradient (bottom to top) -->
        <LinearGradientBrush x:Key="LevelGradientBrush" StartPoint="0,1" EndPoint="0,0">
            <GradientStop Color="{StaticResource MeterGreenColor}" Offset="0.0"/>
            <GradientStop Color="{StaticResource MeterGreenColor}" Offset="0.5"/>
            <GradientStop Color="{StaticResource MeterYellowColor}" Offset="0.7"/>
            <GradientStop Color="{StaticResource MeterOrangeColor}" Offset="0.85"/>
            <GradientStop Color="{StaticResource MeterRedColor}" Offset="0.95"/>
            <GradientStop Color="{StaticResource MeterRedColor}" Offset="1.0"/>
        </LinearGradientBrush>

        <!-- Clip glow effect -->
        <DropShadowEffect x:Key="ClipGlowEffect"
                          Color="#FF3333"
                          BlurRadius="10"
                          ShadowDepth="0"
                          Opacity="0.9"/>
    </UserControl.Resources>

    <Grid Margin="4">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Clip indicators -->
        <StackPanel Grid.Row="0" Grid.Column="1"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,4">
            <Ellipse x:Name="LeftClipIndicator"
                     Width="12" Height="12"
                     Fill="{StaticResource ClipOffBrush}"
                     Stroke="#602020"
                     StrokeThickness="1"
                     Margin="0,0,4,0"/>
            <Ellipse x:Name="RightClipIndicator"
                     Width="12" Height="12"
                     Fill="{StaticResource ClipOffBrush}"
                     Stroke="#602020"
                     StrokeThickness="1"/>
        </StackPanel>

        <!-- dB Scale -->
        <Canvas x:Name="DbScaleCanvas"
                Grid.Row="1" Grid.Column="0"
                Width="24"
                Background="Transparent"/>

        <!-- Meter tracks -->
        <Grid Grid.Row="1" Grid.Column="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="4"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left meter -->
            <Border Grid.Column="0"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="2"
                    Background="{StaticResource TrackBrush}">
                <Grid Margin="2">
                    <Rectangle x:Name="LeftLevelBar"
                               Fill="{StaticResource LevelGradientBrush}"
                               VerticalAlignment="Bottom"
                               Height="0"/>
                    <Rectangle x:Name="LeftPeakIndicator"
                               Fill="{StaticResource PeakBrush}"
                               Height="2"
                               VerticalAlignment="Bottom"
                               Margin="0,0,0,0"/>
                </Grid>
            </Border>

            <!-- Right meter -->
            <Border Grid.Column="2"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="2"
                    Background="{StaticResource TrackBrush}">
                <Grid Margin="2">
                    <Rectangle x:Name="RightLevelBar"
                               Fill="{StaticResource LevelGradientBrush}"
                               VerticalAlignment="Bottom"
                               Height="0"/>
                    <Rectangle x:Name="RightPeakIndicator"
                               Fill="{StaticResource PeakBrush}"
                               Height="2"
                               VerticalAlignment="Bottom"
                               Margin="0,0,0,0"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Channel labels -->
        <StackPanel Grid.Row="2" Grid.Column="1"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,2,0,0">
            <TextBlock Text="L" Foreground="{StaticResource TextBrush}"
                       FontSize="10" FontWeight="SemiBold" Margin="0,0,12,0"/>
            <TextBlock Text="R" Foreground="{StaticResource TextBrush}"
                       FontSize="10" FontWeight="SemiBold"/>
        </StackPanel>

        <!-- Peak value display -->
        <Border Grid.Row="3" Grid.ColumnSpan="2"
                Background="{StaticResource TrackBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="2"
                Margin="0,4,0,0"
                Padding="4,2">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="Peak:" Foreground="{StaticResource TextBrush}"
                           FontSize="9" VerticalAlignment="Center"/>
                <TextBlock x:Name="PeakValueText"
                           Grid.Column="1"
                           Text="-inf dBTP"
                           Foreground="{StaticResource ValueTextBrush}"
                           FontSize="10"
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
