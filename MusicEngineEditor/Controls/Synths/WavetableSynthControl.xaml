<UserControl x:Class="MusicEngineEditor.Controls.Synths.WavetableSynthControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:MusicEngineEditor.Controls.Synths"
             xmlns:vm="clr-namespace:MusicEngineEditor.ViewModels.Synths"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="900"
             d:DataContext="{d:DesignInstance Type=vm:WavetableSynthViewModel, IsDesignTimeCreatable=True}"
             Background="#0D0D0D"
             Loaded="WavetableSynthControl_Loaded">

    <UserControl.Resources>
        <!-- Converters -->
        <local:WavetableBoolToColorConverter x:Key="BoolToColorConverter"/>
        <local:WavetableBoolToStatusConverter x:Key="BoolToStatusConverter"/>

        <!-- Dark Theme Colors -->
        <Color x:Key="BackgroundColor">#0D0D0D</Color>
        <Color x:Key="PanelColor">#181818</Color>
        <Color x:Key="BorderColor">#2A2A2A</Color>
        <Color x:Key="AccentColor">#00D9FF</Color>
        <Color x:Key="AccentSecondaryColor">#00FF88</Color>
        <Color x:Key="TextColor">#E0E0E0</Color>
        <Color x:Key="TextDimColor">#808080</Color>
        <Color x:Key="KnobTrackColor">#333333</Color>

        <!-- Brushes -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="{StaticResource BackgroundColor}"/>
        <SolidColorBrush x:Key="PanelBrush" Color="{StaticResource PanelColor}"/>
        <SolidColorBrush x:Key="BorderBrush" Color="{StaticResource BorderColor}"/>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>
        <SolidColorBrush x:Key="AccentSecondaryBrush" Color="{StaticResource AccentSecondaryColor}"/>
        <SolidColorBrush x:Key="TextBrush" Color="{StaticResource TextColor}"/>
        <SolidColorBrush x:Key="TextDimBrush" Color="{StaticResource TextDimColor}"/>
        <SolidColorBrush x:Key="KnobTrackBrush" Color="{StaticResource KnobTrackColor}"/>

        <!-- Waveform Gradient -->
        <LinearGradientBrush x:Key="WaveformGradient" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="#00D9FF" Offset="0.0"/>
            <GradientStop Color="#00FFB8" Offset="0.5"/>
            <GradientStop Color="#00FF88" Offset="1.0"/>
        </LinearGradientBrush>

        <!-- Panel Style -->
        <Style x:Key="PanelStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource PanelBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="8"/>
        </Style>

        <!-- Section Header Style -->
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
            <!-- Uppercase via CharacterCasing in code or manual text -->
        </Style>

        <!-- Parameter Label Style -->
        <Style x:Key="ParamLabelStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextDimBrush}"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,4,0,0"/>
        </Style>

        <!-- Parameter Value Style -->
        <Style x:Key="ParamValueStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="FontFamily" Value="Consolas"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
        </Style>

        <!-- Slider Style -->
        <Style x:Key="DarkSliderStyle" TargetType="Slider">
            <Setter Property="Minimum" Value="0"/>
            <Setter Property="Maximum" Value="1"/>
            <Setter Property="Background" Value="{StaticResource KnobTrackBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Height" Value="20"/>
        </Style>

        <!-- Button Style -->
        <Style x:Key="DarkButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PanelBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                                <Setter TargetName="border" Property="Background" Value="#222222"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="Foreground" Value="#0D0D0D"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Toggle Button Style -->
        <Style x:Key="ToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="Background" Value="{StaticResource PanelBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="Foreground" Value="#0D0D0D"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ComboBox Style -->
        <Style x:Key="DarkComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="{StaticResource PanelBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,4"/>
        </Style>

        <!-- ListBox Style -->
        <Style x:Key="PresetListStyle" TargetType="ListBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                        <Setter Property="Padding" Value="8,6"/>
                        <Setter Property="Cursor" Value="Hand"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListBoxItem">
                                    <Border x:Name="border"
                                            Background="{TemplateBinding Background}"
                                            Padding="{TemplateBinding Padding}"
                                            CornerRadius="2">
                                        <ContentPresenter/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#252525"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#00D9FF"/>
                                            <Setter Property="Foreground" Value="#0D0D0D"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="180"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="220"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Grid.ColumnSpan="3"
                Style="{StaticResource PanelStyle}"
                Margin="8,8,8,4"
                Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="WAVETABLE SYNTH"
                               Foreground="{StaticResource AccentBrush}"
                               FontSize="14" FontWeight="Bold"/>
                    <TextBlock Text=" - " Foreground="{StaticResource TextDimBrush}"/>
                    <TextBlock Text="{Binding CurrentWavetableName}"
                               Foreground="{StaticResource TextBrush}"
                               FontSize="12"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Pad" Style="{StaticResource DarkButtonStyle}"
                            Command="{Binding LoadPadPresetCommand}"
                            Margin="0,0,4,0"/>
                    <Button Content="Lead" Style="{StaticResource DarkButtonStyle}"
                            Command="{Binding LoadLeadPresetCommand}"
                            Margin="0,0,4,0"/>
                    <Button Content="Vocal" Style="{StaticResource DarkButtonStyle}"
                            Command="{Binding LoadVocalPresetCommand}"
                            Margin="0,0,8,0"/>
                    <Button Content="Reset" Style="{StaticResource DarkButtonStyle}"
                            Command="{Binding ResetParametersCommand}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Left Panel: Wavetable Browser -->
        <Border Grid.Row="1" Grid.Column="0"
                Style="{StaticResource PanelStyle}"
                Margin="8,4,4,4">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Text="WAVETABLE BROWSER" Style="{StaticResource SectionHeaderStyle}"/>

                <!-- Category Filter -->
                <ComboBox Grid.Row="1"
                          ItemsSource="{Binding Categories}"
                          SelectedIndex="0"
                          Background="{StaticResource PanelBrush}"
                          Foreground="{StaticResource TextBrush}"
                          BorderBrush="{StaticResource BorderBrush}"
                          Margin="0,0,0,8"/>

                <!-- Preset List -->
                <ListBox Grid.Row="2"
                         Style="{StaticResource PresetListStyle}"
                         ItemsSource="{Binding Presets}"
                         SelectedItem="{Binding SelectedPreset}"
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel>
                                <TextBlock Text="{Binding Name}" FontSize="11"/>
                                <TextBlock Text="{Binding Category}"
                                           FontSize="9"
                                           Foreground="{StaticResource TextDimBrush}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Load Custom Button -->
                <Button Grid.Row="3"
                        Content="Load Custom WAV..."
                        Style="{StaticResource DarkButtonStyle}"
                        Command="{Binding BrowseWavetableCommand}"
                        Margin="0,8,0,0"/>
            </Grid>
        </Border>

        <!-- Center Panel: 3D Visualization -->
        <Border Grid.Row="1" Grid.Column="1"
                Style="{StaticResource PanelStyle}"
                Margin="4">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Visualization Header -->
                <Grid>
                    <TextBlock Text="WAVETABLE VISUALIZATION"
                               Style="{StaticResource SectionHeaderStyle}"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <ToggleButton Content="3D"
                                      Style="{StaticResource ToggleButtonStyle}"
                                      IsChecked="{Binding Is3DViewEnabled}"
                                      Margin="0,0,4,0"/>
                        <Button Content="-" Style="{StaticResource DarkButtonStyle}"
                                Command="{Binding ZoomOutCommand}"
                                Width="24" Padding="0"/>
                        <Button Content="+" Style="{StaticResource DarkButtonStyle}"
                                Command="{Binding ZoomInCommand}"
                                Width="24" Padding="0" Margin="2,0,0,0"/>
                    </StackPanel>
                </Grid>

                <!-- 3D/2D Visualization Canvas -->
                <Border Grid.Row="1"
                        Background="#0A0A0A"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        ClipToBounds="True">
                    <Canvas x:Name="WavetableCanvas"
                            SizeChanged="WavetableCanvas_SizeChanged"
                            MouseLeftButtonDown="WavetableCanvas_MouseLeftButtonDown"
                            MouseMove="WavetableCanvas_MouseMove"
                            MouseLeftButtonUp="WavetableCanvas_MouseLeftButtonUp"
                            MouseWheel="WavetableCanvas_MouseWheel"/>
                </Border>

                <!-- Position Slider -->
                <Grid Grid.Row="2" Margin="0,8,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="POSITION"
                               Foreground="{StaticResource TextDimBrush}"
                               FontSize="10"
                               VerticalAlignment="Center"
                               Margin="0,0,8,0"/>

                    <Slider Grid.Column="1"
                            Style="{StaticResource DarkSliderStyle}"
                            Value="{Binding Position}"
                            Minimum="0" Maximum="1"
                            TickFrequency="0.01"
                            IsSnapToTickEnabled="False"/>

                    <TextBlock Grid.Column="2"
                               Text="{Binding Position, StringFormat={}{0:P0}}"
                               Style="{StaticResource ParamValueStyle}"
                               Width="40"
                               VerticalAlignment="Center"
                               Margin="8,0,0,0"/>
                </Grid>

                <!-- Current Waveform Display -->
                <Border Grid.Row="3"
                        Height="60"
                        Background="#0A0A0A"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="2"
                        Margin="0,8,0,0"
                        ClipToBounds="True">
                    <Canvas x:Name="CurrentWaveformCanvas"/>
                </Border>
            </Grid>
        </Border>

        <!-- Right Panel: Parameters -->
        <Border Grid.Row="1" Grid.Column="2"
                Style="{StaticResource PanelStyle}"
                Margin="4,4,8,4">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- Main Controls -->
                    <TextBlock Text="MAIN" Style="{StaticResource SectionHeaderStyle}"/>
                    <local:KnobControl x:Name="VolumeKnob"
                                       Label="Volume"
                                       Value="{Binding Volume, Mode=TwoWay}"
                                       Minimum="0" Maximum="1"
                                       Margin="0,0,0,8"/>

                    <!-- Filter Section -->
                    <TextBlock Text="FILTER" Style="{StaticResource SectionHeaderStyle}" Margin="0,8,0,8"/>
                    <UniformGrid Columns="2" Margin="0,0,0,8">
                        <local:KnobControl Label="Cutoff"
                                           Value="{Binding FilterCutoff, Mode=TwoWay}"
                                           Minimum="0" Maximum="1"/>
                        <local:KnobControl Label="Resonance"
                                           Value="{Binding FilterResonance, Mode=TwoWay}"
                                           Minimum="0" Maximum="1"/>
                    </UniformGrid>

                    <!-- Envelope Section -->
                    <TextBlock Text="ENVELOPE" Style="{StaticResource SectionHeaderStyle}" Margin="0,8,0,8"/>
                    <UniformGrid Columns="2" Rows="2" Margin="0,0,0,8">
                        <local:KnobControl Label="Attack"
                                           Value="{Binding Attack, Mode=TwoWay}"
                                           Minimum="0.001" Maximum="2"
                                           ValueFormat="F2"/>
                        <local:KnobControl Label="Decay"
                                           Value="{Binding Decay, Mode=TwoWay}"
                                           Minimum="0.001" Maximum="2"
                                           ValueFormat="F2"/>
                        <local:KnobControl Label="Sustain"
                                           Value="{Binding Sustain, Mode=TwoWay}"
                                           Minimum="0" Maximum="1"/>
                        <local:KnobControl Label="Release"
                                           Value="{Binding Release, Mode=TwoWay}"
                                           Minimum="0.001" Maximum="5"
                                           ValueFormat="F2"/>
                    </UniformGrid>

                    <!-- Unison Section -->
                    <TextBlock Text="UNISON" Style="{StaticResource SectionHeaderStyle}" Margin="0,8,0,8"/>
                    <Grid Margin="0,0,0,8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Voices"
                                   Style="{StaticResource ParamLabelStyle}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0"/>
                        <Slider Grid.Column="1"
                                Style="{StaticResource DarkSliderStyle}"
                                Value="{Binding UnisonVoices}"
                                Minimum="1" Maximum="8"
                                TickFrequency="1"
                                IsSnapToTickEnabled="True"/>
                        <TextBlock Grid.Column="2"
                                   Text="{Binding UnisonVoices}"
                                   Style="{StaticResource ParamValueStyle}"
                                   Width="24"
                                   VerticalAlignment="Center"
                                   Margin="8,0,0,0"/>
                    </Grid>
                    <UniformGrid Columns="2">
                        <local:KnobControl Label="Detune"
                                           Value="{Binding UnisonDetune, Mode=TwoWay}"
                                           Minimum="0" Maximum="50"
                                           ValueFormat="F0"/>
                        <local:KnobControl Label="Spread"
                                           Value="{Binding UnisonSpread, Mode=TwoWay}"
                                           Minimum="0" Maximum="1"/>
                    </UniformGrid>

                    <!-- Detune -->
                    <TextBlock Text="DETUNE" Style="{StaticResource SectionHeaderStyle}" Margin="0,16,0,8"/>
                    <local:KnobControl Label="Master Detune"
                                       Value="{Binding Detune, Mode=TwoWay}"
                                       Minimum="-100" Maximum="100"
                                       ValueFormat="F0"/>

                    <!-- Position Modulation -->
                    <TextBlock Text="POSITION MOD" Style="{StaticResource SectionHeaderStyle}" Margin="0,16,0,8"/>
                    <UniformGrid Columns="2">
                        <local:KnobControl Label="Env Amt"
                                           Value="{Binding PositionEnvAmount, Mode=TwoWay}"
                                           Minimum="-1" Maximum="1"/>
                        <local:KnobControl Label="LFO Depth"
                                           Value="{Binding PositionLfoDepth, Mode=TwoWay}"
                                           Minimum="0" Maximum="1"/>
                    </UniformGrid>

                    <!-- Warp Mode Section -->
                    <TextBlock Text="WARP MODE" Style="{StaticResource SectionHeaderStyle}" Margin="0,16,0,8"/>
                    <Grid Margin="0,0,0,8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Mode"
                                   Style="{StaticResource ParamLabelStyle}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0"/>
                        <ComboBox Grid.Column="1"
                                  Style="{StaticResource DarkComboBoxStyle}"
                                  ItemsSource="{Binding WarpModes}"
                                  SelectedItem="{Binding WarpMode}"/>
                    </Grid>
                    <local:KnobControl Label="Warp Amount"
                                       Value="{Binding WarpAmount, Mode=TwoWay}"
                                       Minimum="0" Maximum="1"/>

                    <!-- Sub-Oscillator Section -->
                    <TextBlock Text="SUB OSCILLATOR" Style="{StaticResource SectionHeaderStyle}" Margin="0,16,0,8"/>
                    <Grid Margin="0,0,0,8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Octave"
                                   Style="{StaticResource ParamLabelStyle}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0"/>
                        <ComboBox Grid.Column="1"
                                  Style="{StaticResource DarkComboBoxStyle}"
                                  ItemsSource="{Binding SubOscillatorOctaves}"
                                  SelectedItem="{Binding SubOscillatorOctave}"/>
                    </Grid>
                    <local:KnobControl Label="Sub Level"
                                       Value="{Binding SubOscillatorLevel, Mode=TwoWay}"
                                       Minimum="0" Maximum="1"/>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Bottom Status Bar -->
        <Border Grid.Row="2" Grid.ColumnSpan="3"
                Style="{StaticResource PanelStyle}"
                Margin="8,4,8,8"
                Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="{Binding StatusMessage}"
                           Foreground="{StaticResource TextDimBrush}"
                           FontSize="10"
                           VerticalAlignment="Center"/>

                <TextBlock Grid.Column="1"
                           VerticalAlignment="Center"
                           Margin="0,0,16,0">
                    <Run Text="Frames: " Foreground="{StaticResource TextDimBrush}"/>
                    <Run Text="{Binding FrameCount}" Foreground="{StaticResource TextBrush}"/>
                    <Run Text=" | Size: " Foreground="{StaticResource TextDimBrush}"/>
                    <Run Text="{Binding FrameSize}" Foreground="{StaticResource TextBrush}"/>
                </TextBlock>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Ellipse Width="8" Height="8"
                             Fill="{Binding IsPlaying, Converter={StaticResource BoolToColorConverter}, FallbackValue=#333333}"
                             Margin="0,0,4,0"/>
                    <TextBlock Text="{Binding IsPlaying, Converter={StaticResource BoolToStatusConverter}, FallbackValue=Idle}"
                               Foreground="{StaticResource TextDimBrush}"
                               FontSize="10"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
