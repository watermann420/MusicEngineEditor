<UserControl x:Class="MusicEngineEditor.Controls.AutomationToolbar"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="32" d:DesignWidth="600"
             Background="#1E1F22">

    <UserControl.Resources>
        <!-- Theme Colors -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="#1E1F22"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#393B40"/>
        <SolidColorBrush x:Key="ForegroundBrush" Color="#BCBEC4"/>
        <SolidColorBrush x:Key="SecondaryForegroundBrush" Color="#6F737A"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#4B6EAF"/>
        <SolidColorBrush x:Key="RecordArmBrush" Color="#CC4B4B"/>
        <SolidColorBrush x:Key="RecordArmActiveBrush" Color="#FF5555"/>
        <SolidColorBrush x:Key="TouchModeBrush" Color="#6AAB73"/>
        <SolidColorBrush x:Key="LatchModeBrush" Color="#D9A343"/>
        <SolidColorBrush x:Key="WriteModeBrush" Color="#C75450"/>

        <!-- Toolbar Button Style -->
        <Style x:Key="ToolbarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource SecondaryForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#3C3F41"/>
                                <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#4B6EAF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Toggle Button Style -->
        <Style x:Key="ToolbarToggleStyle" TargetType="ToggleButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource SecondaryForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#3C3F41"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource AccentBrush}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Arm Toggle Style (Red) -->
        <Style x:Key="ArmToggleStyle" TargetType="ToggleButton" BasedOn="{StaticResource ToolbarToggleStyle}">
            <Style.Triggers>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="Background" Value="{StaticResource RecordArmBrush}"/>
                    <Setter Property="BorderBrush" Value="{StaticResource RecordArmBrush}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Recording Mode Radio Button Style -->
        <Style x:Key="RecordingModeStyle" TargetType="RadioButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource SecondaryForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#3C3F41"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{Binding Tag, RelativeSource={RelativeSource Self}}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{Binding Tag, RelativeSource={RelativeSource Self}}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Separator -->
        <Style x:Key="ToolbarSeparatorStyle" TargetType="Rectangle">
            <Setter Property="Width" Value="1"/>
            <Setter Property="Fill" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Margin" Value="8,4"/>
        </Style>
    </UserControl.Resources>

    <Border Background="{StaticResource BackgroundBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="0,0,0,1">
        <StackPanel Orientation="Horizontal" Margin="8,4">
            <!-- Automation Label -->
            <TextBlock Text="Automation:"
                       Foreground="{StaticResource ForegroundBrush}"
                       VerticalAlignment="Center"
                       FontSize="11"
                       FontWeight="SemiBold"
                       Margin="0,0,12,0"/>

            <!-- Recording Mode Selector -->
            <StackPanel Orientation="Horizontal" Margin="0,0,8,0">
                <TextBlock Text="Mode:"
                           Foreground="{StaticResource SecondaryForegroundBrush}"
                           VerticalAlignment="Center"
                           FontSize="10"
                           Margin="0,0,6,0"/>

                <RadioButton x:Name="OffModeButton"
                             Style="{StaticResource RecordingModeStyle}"
                             Content="Off"
                             Tag="{StaticResource BorderBrush}"
                             GroupName="RecordingMode"
                             IsChecked="True"
                             Checked="RecordingMode_Checked"
                             ToolTip="Automation playback only, no recording"/>

                <RadioButton x:Name="TouchModeButton"
                             Style="{StaticResource RecordingModeStyle}"
                             Content="Touch"
                             Tag="{StaticResource TouchModeBrush}"
                             GroupName="RecordingMode"
                             Margin="4,0,0,0"
                             Checked="RecordingMode_Checked"
                             ToolTip="Record while touching control, return to existing curve on release"/>

                <RadioButton x:Name="LatchModeButton"
                             Style="{StaticResource RecordingModeStyle}"
                             Content="Latch"
                             Tag="{StaticResource LatchModeBrush}"
                             GroupName="RecordingMode"
                             Margin="4,0,0,0"
                             Checked="RecordingMode_Checked"
                             ToolTip="Start recording on first touch, continue until stop"/>

                <RadioButton x:Name="WriteModeButton"
                             Style="{StaticResource RecordingModeStyle}"
                             Content="Write"
                             Tag="{StaticResource WriteModeBrush}"
                             GroupName="RecordingMode"
                             Margin="4,0,0,0"
                             Checked="RecordingMode_Checked"
                             ToolTip="Always overwrite existing automation"/>
            </StackPanel>

            <Rectangle Style="{StaticResource ToolbarSeparatorStyle}"/>

            <!-- Arm Button -->
            <ToggleButton x:Name="ArmButton"
                          Style="{StaticResource ArmToggleStyle}"
                          Content="ARM"
                          Margin="0,0,8,0"
                          Click="ArmButton_Click"
                          ToolTip="Arm selected lanes for automation recording">
                <ToggleButton.Resources>
                    <Storyboard x:Key="ArmPulse">
                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                         From="1.0" To="0.5"
                                         Duration="0:0:0.5"
                                         AutoReverse="True"
                                         RepeatBehavior="Forever"/>
                    </Storyboard>
                </ToggleButton.Resources>
            </ToggleButton>

            <Rectangle Style="{StaticResource ToolbarSeparatorStyle}"/>

            <!-- Show All Lanes Toggle -->
            <ToggleButton x:Name="ShowAllLanesButton"
                          Style="{StaticResource ToolbarToggleStyle}"
                          Content="Show All"
                          Margin="0,0,8,0"
                          Click="ShowAllLanesButton_Click"
                          ToolTip="Show all automation lanes"/>

            <!-- Show Used Lanes Only -->
            <ToggleButton x:Name="ShowUsedLanesButton"
                          Style="{StaticResource ToolbarToggleStyle}"
                          Content="Used Only"
                          Click="ShowUsedLanesButton_Click"
                          ToolTip="Show only lanes with automation data"/>

            <Rectangle Style="{StaticResource ToolbarSeparatorStyle}"/>

            <!-- Snap to Grid Toggle -->
            <ToggleButton x:Name="SnapToGridButton"
                          Style="{StaticResource ToolbarToggleStyle}"
                          Content="Snap"
                          IsChecked="True"
                          Margin="0,0,8,0"
                          Click="SnapToGridButton_Click"
                          ToolTip="Snap automation points to grid"/>

            <!-- Grid Size -->
            <ComboBox x:Name="GridSizeCombo"
                      Width="60"
                      Height="22"
                      FontSize="10"
                      VerticalContentAlignment="Center"
                      SelectedIndex="2"
                      SelectionChanged="GridSizeCombo_SelectionChanged"
                      ToolTip="Grid subdivision size">
                <ComboBoxItem Content="1/1"/>
                <ComboBoxItem Content="1/2"/>
                <ComboBoxItem Content="1/4"/>
                <ComboBoxItem Content="1/8"/>
                <ComboBoxItem Content="1/16"/>
                <ComboBoxItem Content="1/32"/>
            </ComboBox>

            <Rectangle Style="{StaticResource ToolbarSeparatorStyle}"/>

            <!-- Default Curve Type -->
            <TextBlock Text="Curve:"
                       Foreground="{StaticResource SecondaryForegroundBrush}"
                       VerticalAlignment="Center"
                       FontSize="10"
                       Margin="0,0,6,0"/>

            <ComboBox x:Name="DefaultCurveCombo"
                      Width="90"
                      Height="22"
                      FontSize="10"
                      VerticalContentAlignment="Center"
                      SelectedIndex="0"
                      SelectionChanged="DefaultCurveCombo_SelectionChanged"
                      ToolTip="Default curve type for new points">
                <ComboBoxItem Content="Linear"/>
                <ComboBoxItem Content="Bezier"/>
                <ComboBoxItem Content="Step"/>
                <ComboBoxItem Content="Exponential"/>
                <ComboBoxItem Content="S-Curve"/>
            </ComboBox>

            <Rectangle Style="{StaticResource ToolbarSeparatorStyle}"/>

            <!-- Clear Automation -->
            <Button x:Name="ClearButton"
                    Style="{StaticResource ToolbarButtonStyle}"
                    Content="Clear"
                    Click="ClearButton_Click"
                    ToolTip="Clear automation on selected lane"/>

            <!-- Copy/Paste -->
            <Button x:Name="CopyButton"
                    Style="{StaticResource ToolbarButtonStyle}"
                    Content="Copy"
                    Click="CopyButton_Click"
                    ToolTip="Copy selected automation points"/>

            <Button x:Name="PasteButton"
                    Style="{StaticResource ToolbarButtonStyle}"
                    Content="Paste"
                    Click="PasteButton_Click"
                    ToolTip="Paste automation points"/>
        </StackPanel>
    </Border>
</UserControl>
