<Window x:Class="MusicEngineEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit"
        xmlns:avalonDock="https://github.com/Dirkster99/AvalonDock"
        xmlns:views="clr-namespace:MusicEngineEditor.Views"
        Title="MusicEngine Editor"
        Height="800" Width="1200"
        MinHeight="500" MinWidth="800"
        Style="{StaticResource DarkWindowStyle}"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized">

    <Window.InputBindings>
        <!-- Run with Ctrl+Enter or F5 -->
        <KeyBinding Key="Enter" Modifiers="Ctrl" Command="{Binding RunCommand}"/>
        <KeyBinding Key="F5" Command="{Binding RunCommand}"/>
        <!-- Stop with Escape -->
        <KeyBinding Key="Escape" Command="{Binding StopCommand}"/>
        <KeyBinding Key="F5" Modifiers="Shift" Command="{Binding StopCommand}"/>
        <!-- File operations -->
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SaveCommand}"/>
        <KeyBinding Key="S" Modifiers="Ctrl+Shift" Command="{Binding SaveAllCommand}"/>
        <KeyBinding Key="O" Modifiers="Ctrl+Shift" Command="{Binding OpenProjectCommand}"/>
        <KeyBinding Key="N" Modifiers="Ctrl+Shift" Command="{Binding NewProjectCommand}"/>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding NewFileCommand}"/>
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding FindCommand}"/>
        <KeyBinding Key="H" Modifiers="Ctrl" Command="{Binding ReplaceCommand}"/>
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="{StaticResource MenuBackgroundBrush}" Padding="4,2">
            <MenuItem Header="_File">
                <MenuItem Header="_New Project..." InputGestureText="Ctrl+Shift+N" Click="NewProject_Click"/>
                <MenuItem Header="_Open Project..." InputGestureText="Ctrl+Shift+O" Click="OpenProject_Click"/>
                <Separator/>
                <MenuItem Header="New _File..." InputGestureText="Ctrl+N" Click="NewFile_Click"/>
                <MenuItem Header="_Save" InputGestureText="Ctrl+S" Click="SaveScript_Click"/>
                <MenuItem Header="Save _All" InputGestureText="Ctrl+Shift+S" Click="SaveAll_Click"/>
                <Separator/>
                <MenuItem Header="Recent Projects" x:Name="RecentProjectsMenu"/>
                <Separator/>
                <MenuItem Header="E_xit" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Undo" Command="Undo" InputGestureText="Ctrl+Z"/>
                <MenuItem Header="_Redo" Command="Redo" InputGestureText="Ctrl+Y"/>
                <Separator/>
                <MenuItem Header="Cu_t" Command="Cut" InputGestureText="Ctrl+X"/>
                <MenuItem Header="_Copy" Command="Copy" InputGestureText="Ctrl+C"/>
                <MenuItem Header="_Paste" Command="Paste" InputGestureText="Ctrl+V"/>
                <Separator/>
                <MenuItem Header="_Find..." InputGestureText="Ctrl+F" Click="Find_Click"/>
                <MenuItem Header="Find and _Replace..." InputGestureText="Ctrl+H" Click="Replace_Click"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="Project Explorer" IsCheckable="True" IsChecked="True" x:Name="ProjectExplorerMenuItem" Click="ToggleProjectExplorer_Click"/>
                <MenuItem Header="Output" IsCheckable="True" IsChecked="True" x:Name="OutputMenuItem" Click="ToggleOutput_Click"/>
                <Separator/>
                <MenuItem Header="MIDI Devices" IsCheckable="True" IsChecked="False" x:Name="MidiPanelMenuItem" Click="ToggleMidiPanel_Click"/>
                <MenuItem Header="VST Plugins" IsCheckable="True" IsChecked="False" x:Name="VstPanelMenuItem" Click="ToggleVstPanel_Click"/>
                <MenuItem Header="Audio Files" IsCheckable="True" IsChecked="False" x:Name="AudioPanelMenuItem" Click="ToggleAudioPanel_Click"/>
            </MenuItem>
            <MenuItem Header="_Project">
                <MenuItem Header="_Add New Script..." Click="AddScript_Click"/>
                <MenuItem Header="Import _Audio..." Click="ImportAudio_Click"/>
                <Separator/>
                <MenuItem Header="Add Project _Reference..." Click="AddReference_Click"/>
                <Separator/>
                <MenuItem Header="Project _Settings..." Click="ProjectSettings_Click"/>
            </MenuItem>
            <MenuItem Header="_Run">
                <MenuItem Header="_Run" InputGestureText="Ctrl+Enter" Click="RunScript_Click"/>
                <MenuItem Header="_Stop" InputGestureText="Esc" Click="Stop_Click"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_Documentation" Click="Documentation_Click"/>
                <MenuItem Header="_About" Click="About_Click"/>
            </MenuItem>
        </Menu>

        <!-- Main Toolbar -->
        <Border Grid.Row="1" Background="{StaticResource ToolbarBackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
            <DockPanel Margin="8,6">
                <!-- Left: Project Buttons -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                    <Button Style="{StaticResource IconButtonStyle}" Click="NewProject_Click" ToolTip="New Project (Ctrl+Shift+N)">
                        <TextBlock Text="+" FontSize="16" FontWeight="Bold"/>
                    </Button>
                    <Button Style="{StaticResource IconButtonStyle}" Click="OpenProject_Click" ToolTip="Open Project (Ctrl+Shift+O)" Margin="2,0,0,0">
                        <TextBlock Text="&#x1F4C2;" FontSize="14"/>
                    </Button>
                    <Button Style="{StaticResource IconButtonStyle}" Click="SaveAll_Click" ToolTip="Save All (Ctrl+Shift+S)" Margin="2,0,0,0">
                        <TextBlock Text="&#x1F4BE;" FontSize="14"/>
                    </Button>

                    <Rectangle Width="1" Fill="{StaticResource BorderBrush}" Margin="12,4"/>

                    <!-- Run Controls -->
                    <Button x:Name="RunButton" Content="Run" Style="{StaticResource RunButtonStyle}" Click="RunScript_Click" ToolTip="Execute Script (Ctrl+Enter)"/>
                    <Button Content="Stop" Style="{StaticResource StopButtonStyle}" Click="Stop_Click" ToolTip="Stop (Esc)" Margin="6,0,0,0"/>
                </StackPanel>

                <!-- Right: Sequencer Status -->
                <Border DockPanel.Dock="Right" Background="{StaticResource HeaderBackgroundBrush}"
                        CornerRadius="4" Padding="12,4" Margin="8,0,0,0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="BPM" Foreground="{StaticResource SecondaryForegroundBrush}"
                                   VerticalAlignment="Center" Margin="0,0,6,0"/>
                        <TextBox x:Name="BpmBox" Text="120" Width="45"
                                 Style="{StaticResource InputTextBoxStyle}"
                                 VerticalAlignment="Center"
                                 TextAlignment="Center"
                                 KeyDown="BpmBox_KeyDown"/>

                        <Rectangle Width="1" Fill="{StaticResource BorderBrush}" Margin="12,2"/>

                        <TextBlock Text="Patterns" Foreground="{StaticResource SecondaryForegroundBrush}"
                                   VerticalAlignment="Center" Margin="0,0,6,0"/>
                        <TextBlock x:Name="PatternCountDisplay" Text="0"
                                   Foreground="{StaticResource BrightForegroundBrush}"
                                   FontWeight="SemiBold" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Center: Active Instruments Display -->
                <Border Background="{StaticResource HeaderBackgroundBrush}"
                        CornerRadius="4" Padding="8,4" Margin="12,0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Active:" Foreground="{StaticResource SecondaryForegroundBrush}"
                                   VerticalAlignment="Center" Margin="0,0,8,0" FontSize="11"/>
                        <ItemsControl x:Name="ActiveInstrumentsPanel">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border x:Name="InstrumentBorder"
                                            Background="{Binding BackgroundBrush}"
                                            CornerRadius="3" Padding="8,3" Margin="2,0"
                                            BorderBrush="{Binding BorderBrush}"
                                            BorderThickness="1">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Icon}"
                                                       Foreground="{Binding IconColor}"
                                                       FontSize="12" Margin="0,0,4,0"
                                                       VerticalAlignment="Center"/>
                                            <TextBlock x:Name="InstrumentName"
                                                       Text="{Binding Name}"
                                                       Foreground="{Binding TextColor}"
                                                       FontWeight="{Binding FontWeight}"
                                                       FontSize="11"
                                                       VerticalAlignment="Center">
                                                <TextBlock.RenderTransform>
                                                    <ScaleTransform x:Name="NameScale" ScaleX="1" ScaleY="1"/>
                                                </TextBlock.RenderTransform>
                                            </TextBlock>
                                            <TextBlock Text="{Binding CurrentNote}"
                                                       Foreground="{Binding NoteColor}"
                                                       FontFamily="JetBrains Mono, Consolas"
                                                       FontSize="10" FontWeight="Bold"
                                                       VerticalAlignment="Center"
                                                       Margin="6,0,0,0"
                                                       Visibility="{Binding NoteVisibility}"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <TextBlock x:Name="NoInstrumentsText" Text="(keine)"
                                   Foreground="{StaticResource SecondaryForegroundBrush}"
                                   FontSize="11" FontStyle="Italic"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </DockPanel>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="240" MinWidth="180" x:Name="LeftPanelColumn"/>
                <ColumnDefinition Width="1"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="1" x:Name="RightSplitterColumn"/>
                <ColumnDefinition Width="0" MinWidth="0" x:Name="RightPanelColumn"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel: Project Explorer -->
            <Border Grid.Column="0" Background="{StaticResource PanelBackgroundBrush}" x:Name="ProjectExplorerPanel">
                <DockPanel>
                    <!-- Panel Header -->
                    <Border DockPanel.Dock="Top" Background="{StaticResource HeaderBackgroundBrush}"
                            Padding="12,8" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                        <TextBlock Text="Project"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource ForegroundBrush}"
                                   FontSize="12"/>
                    </Border>

                    <!-- Project Tree -->
                    <TreeView x:Name="ProjectTree"
                              Background="Transparent"
                              BorderThickness="0"
                              Padding="8,4"
                              MouseDoubleClick="ProjectTree_MouseDoubleClick"/>
                </DockPanel>
            </Border>

            <!-- Left Splitter -->
            <GridSplitter Grid.Column="1" Width="1" HorizontalAlignment="Stretch" ResizeDirection="Columns"
                          Background="{StaticResource BorderBrush}"/>

            <!-- Center: Editor + Output -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" MinHeight="150"/>
                    <RowDefinition Height="Auto" x:Name="OutputSplitterRow"/>
                    <RowDefinition Height="Auto" x:Name="OutputPanelRow"/>
                </Grid.RowDefinitions>

                <!-- Code Editor Area -->
                <Border Grid.Row="0" Background="{StaticResource EditorBackgroundBrush}">
                    <DockPanel>
                        <!-- Tab Bar -->
                        <Border DockPanel.Dock="Top" Background="{StaticResource HeaderBackgroundBrush}"
                                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                            <TabControl x:Name="EditorTabs"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Padding="0"
                                        SelectionChanged="EditorTabs_SelectionChanged">
                                <TabControl.ItemContainerStyle>
                                    <Style TargetType="TabItem">
                                        <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
                                        <Setter Property="Background" Value="Transparent"/>
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="Margin" Value="0"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="TabItem">
                                                    <Border x:Name="Border"
                                                            Background="{TemplateBinding Background}"
                                                            BorderThickness="0,0,1,2"
                                                            BorderBrush="{StaticResource BorderBrush}"
                                                            Padding="14,8">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="&#x1F4C4;" FontSize="12" Margin="0,0,6,0"
                                                                       Foreground="{StaticResource SecondaryForegroundBrush}"/>
                                                            <ContentPresenter ContentSource="Header" VerticalAlignment="Center"/>
                                                            <Button Content="&#x2715;" Margin="10,0,0,0"
                                                                    Background="Transparent"
                                                                    BorderThickness="0"
                                                                    Foreground="{StaticResource SecondaryForegroundBrush}"
                                                                    FontSize="10"
                                                                    Padding="4,2"
                                                                    Cursor="Hand"
                                                                    Click="CloseTab_Click"
                                                                    Tag="{Binding RelativeSource={RelativeSource TemplatedParent}}">
                                                                <Button.Style>
                                                                    <Style TargetType="Button">
                                                                        <Style.Triggers>
                                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                                <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
                                                                            </Trigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Button.Style>
                                                            </Button>
                                                        </StackPanel>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="Border" Property="Background" Value="{StaticResource EditorBackgroundBrush}"/>
                                                            <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                                                        </Trigger>
                                                        <MultiTrigger>
                                                            <MultiTrigger.Conditions>
                                                                <Condition Property="IsSelected" Value="False"/>
                                                                <Condition Property="IsMouseOver" Value="True"/>
                                                            </MultiTrigger.Conditions>
                                                            <Setter TargetName="Border" Property="Background" Value="#3C3F41"/>
                                                        </MultiTrigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </TabControl.ItemContainerStyle>
                            </TabControl>
                        </Border>

                        <!-- Code Editor -->
                        <avalonedit:TextEditor
                            x:Name="CodeEditor"
                            FontFamily="JetBrains Mono, Cascadia Code, Consolas, Courier New"
                            FontSize="13"
                            ShowLineNumbers="True"
                            Background="{StaticResource EditorBackgroundBrush}"
                            Foreground="{StaticResource ForegroundBrush}"
                            LineNumbersForeground="{StaticResource SecondaryForegroundBrush}"
                            Padding="8,4"
                            VerticalScrollBarVisibility="Auto"
                            HorizontalScrollBarVisibility="Auto"/>
                    </DockPanel>
                </Border>

                <!-- Splitter for Output -->
                <GridSplitter Grid.Row="1" Height="1" HorizontalAlignment="Stretch" ResizeDirection="Rows"
                              Background="{StaticResource BorderBrush}" x:Name="OutputSplitter"/>

                <!-- Output Panel (Collapsible) -->
                <Border Grid.Row="2" Background="{StaticResource PanelBackgroundBrush}" x:Name="OutputPanel" Height="200">
                    <DockPanel>
                        <!-- Output Header -->
                        <Border DockPanel.Dock="Top" Background="{StaticResource HeaderBackgroundBrush}"
                                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                            <DockPanel Margin="0">
                                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                                    <Button Content="Clear" Style="{StaticResource ToolbarButtonStyle}"
                                            Click="ClearOutput_Click" FontSize="11" Padding="10,6" Margin="4"/>
                                    <Button Content="&#x2715;" Style="{StaticResource IconButtonStyle}"
                                            Click="ToggleOutput_Click" ToolTip="Close Output" Margin="0,4,4,4"
                                            Width="24" Height="24"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal">
                                    <Border x:Name="OutputTabHeader" Background="{StaticResource AccentBrush}" Padding="14,8" Cursor="Hand" MouseDown="OutputTab_Click">
                                        <TextBlock Text="Output" FontWeight="SemiBold" Foreground="White" FontSize="11"/>
                                    </Border>
                                    <Border x:Name="ProblemsTabHeader" Background="Transparent" Padding="14,8" Cursor="Hand" MouseDown="ProblemsTab_Click">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Problems" Foreground="{StaticResource SecondaryForegroundBrush}" FontSize="11"/>
                                            <Border x:Name="ErrorCountBadge" Background="{StaticResource ErrorBrush}" CornerRadius="8"
                                                    Padding="6,2" Margin="6,0,0,0" Visibility="Collapsed">
                                                <TextBlock x:Name="ErrorCountText" Text="0" Foreground="White" FontSize="10" FontWeight="Bold"/>
                                            </Border>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </DockPanel>
                        </Border>

                        <!-- Output/Problems Content -->
                        <Grid>
                            <!-- Output Content -->
                            <TextBox x:Name="OutputBox"
                                     Style="{StaticResource OutputTextBoxStyle}"
                                     TextWrapping="NoWrap"
                                     AcceptsReturn="True"/>

                            <!-- Problems List -->
                            <ListView x:Name="ProblemsListView" Visibility="Collapsed"
                                      Background="Transparent" BorderThickness="0"
                                      Foreground="{StaticResource ForegroundBrush}"
                                      MouseDoubleClick="ProblemsListView_DoubleClick">
                                <ListView.View>
                                    <GridView>
                                        <GridViewColumn Header="" Width="24">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Icon}" Foreground="{Binding IconColor}" FontSize="12"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Description" Width="400" DisplayMemberBinding="{Binding Message}"/>
                                        <GridViewColumn Header="File" Width="150" DisplayMemberBinding="{Binding FileName}"/>
                                        <GridViewColumn Header="Line" Width="50" DisplayMemberBinding="{Binding Line}"/>
                                        <GridViewColumn Header="Col" Width="50" DisplayMemberBinding="{Binding Column}"/>
                                    </GridView>
                                </ListView.View>
                            </ListView>
                        </Grid>
                    </DockPanel>
                </Border>
            </Grid>

            <!-- Right Splitter -->
            <GridSplitter Grid.Column="3" Width="1" HorizontalAlignment="Stretch" ResizeDirection="Columns"
                          Background="{StaticResource BorderBrush}" x:Name="RightSplitter" Visibility="Collapsed"/>

            <!-- Right Panel (MIDI/VST/Audio) -->
            <Border Grid.Column="4" Background="{StaticResource PanelBackgroundBrush}" x:Name="RightPanel" Visibility="Collapsed">
                <DockPanel>
                    <!-- Panel Header with Tabs -->
                    <Border DockPanel.Dock="Top" Background="{StaticResource HeaderBackgroundBrush}"
                            BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                        <DockPanel>
                            <Button Content="&#x2715;" Style="{StaticResource IconButtonStyle}"
                                    Click="CloseRightPanel_Click" ToolTip="Close Panel" DockPanel.Dock="Right"
                                    Width="24" Height="24" Margin="4"/>
                            <StackPanel Orientation="Horizontal">
                                <Border x:Name="MidiTabHeader" Background="{StaticResource AccentBrush}" Padding="12,8" Cursor="Hand" MouseDown="MidiTab_Click">
                                    <TextBlock Text="MIDI" FontWeight="SemiBold" Foreground="White" FontSize="11"/>
                                </Border>
                                <Border x:Name="VstTabHeader" Background="Transparent" Padding="12,8" Cursor="Hand" MouseDown="VstTab_Click">
                                    <TextBlock Text="VST" Foreground="{StaticResource SecondaryForegroundBrush}" FontSize="11"/>
                                </Border>
                                <Border x:Name="AudioTabHeader" Background="Transparent" Padding="12,8" Cursor="Hand" MouseDown="AudioTab_Click">
                                    <TextBlock Text="Audio" Foreground="{StaticResource SecondaryForegroundBrush}" FontSize="11"/>
                                </Border>
                            </StackPanel>
                        </DockPanel>
                    </Border>

                    <!-- Tab Content -->
                    <Grid>
                        <!-- MIDI Devices Panel -->
                        <Border x:Name="MidiDevicesPanel" Visibility="Visible" Padding="8">
                            <DockPanel>
                                <Button Content="Refresh" Style="{StaticResource ToolbarButtonStyle}"
                                        DockPanel.Dock="Top" Click="RefreshMidiDevices_Click" Margin="0,0,0,8"/>
                                <ListView x:Name="MidiDevicesList" Background="Transparent" BorderThickness="0"
                                          Foreground="{StaticResource ForegroundBrush}">
                                    <ListView.View>
                                        <GridView>
                                            <GridViewColumn Header="Device" Width="150" DisplayMemberBinding="{Binding Name}"/>
                                            <GridViewColumn Header="Type" Width="60" DisplayMemberBinding="{Binding Type}"/>
                                            <GridViewColumn Header="Ch" Width="40" DisplayMemberBinding="{Binding Channel}"/>
                                        </GridView>
                                    </ListView.View>
                                </ListView>
                            </DockPanel>
                        </Border>

                        <!-- VST Plugins Panel -->
                        <Border x:Name="VstPluginsPanel" Visibility="Collapsed" Padding="8">
                            <DockPanel>
                                <Button Content="Scan Plugins" Style="{StaticResource ToolbarButtonStyle}"
                                        DockPanel.Dock="Top" Click="ScanVstPlugins_Click" Margin="0,0,0,8"/>
                                <ListView x:Name="VstPluginsList" Background="Transparent" BorderThickness="0"
                                          Foreground="{StaticResource ForegroundBrush}"
                                          MouseDoubleClick="VstPluginsList_DoubleClick">
                                    <ListView.View>
                                        <GridView>
                                            <GridViewColumn Header="Plugin" Width="150" DisplayMemberBinding="{Binding Name}"/>
                                            <GridViewColumn Header="Type" Width="60" DisplayMemberBinding="{Binding Type}"/>
                                            <GridViewColumn Header="Path" Width="100" DisplayMemberBinding="{Binding Path}"/>
                                        </GridView>
                                    </ListView.View>
                                </ListView>
                            </DockPanel>
                        </Border>

                        <!-- Audio Files Panel -->
                        <Border x:Name="AudioFilesPanel" Visibility="Collapsed" Padding="8"
                                AllowDrop="True" Drop="AudioFilesPanel_Drop" DragOver="AudioFilesPanel_DragOver">
                            <DockPanel>
                                <Button Content="Import Audio" Style="{StaticResource ToolbarButtonStyle}"
                                        DockPanel.Dock="Top" Click="ImportAudio_Click" Margin="0,0,0,8"/>
                                <Border x:Name="AudioDropZone" BorderBrush="{StaticResource BorderBrush}"
                                        BorderThickness="2" CornerRadius="4" Margin="0,0,0,8"
                                        Background="Transparent" Padding="16"
                                        AllowDrop="True" Drop="AudioFilesPanel_Drop" DragOver="AudioFilesPanel_DragOver">
                                    <TextBlock Text="Drop audio files here"
                                               Foreground="{StaticResource SecondaryForegroundBrush}"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <ListView x:Name="AudioFilesList" Background="Transparent" BorderThickness="0"
                                          Foreground="{StaticResource ForegroundBrush}" MouseDoubleClick="AudioFile_DoubleClick">
                                    <ListView.View>
                                        <GridView>
                                            <GridViewColumn Header="Name" Width="140" DisplayMemberBinding="{Binding Alias}"/>
                                            <GridViewColumn Header="Duration" Width="60" DisplayMemberBinding="{Binding Duration}"/>
                                            <GridViewColumn Header="Format" Width="50" DisplayMemberBinding="{Binding Format}"/>
                                        </GridView>
                                    </ListView.View>
                                </ListView>
                            </DockPanel>
                        </Border>
                    </Grid>
                </DockPanel>
            </Border>

            <!-- Right Sidebar Tool Buttons -->
            <Border Grid.Column="5" Background="{StaticResource ToolbarBackgroundBrush}"
                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="1,0,0,0">
                <StackPanel Orientation="Vertical" Width="36">
                    <Button Style="{StaticResource IconButtonStyle}" Click="ToggleMidiPanel_Click"
                            ToolTip="MIDI Devices" Margin="4" x:Name="MidiToolButton">
                        <TextBlock Text="M" FontWeight="Bold" FontSize="14"/>
                    </Button>
                    <Button Style="{StaticResource IconButtonStyle}" Click="ToggleVstPanel_Click"
                            ToolTip="VST Plugins" Margin="4" x:Name="VstToolButton">
                        <TextBlock Text="V" FontWeight="Bold" FontSize="14"/>
                    </Button>
                    <Button Style="{StaticResource IconButtonStyle}" Click="ToggleAudioPanel_Click"
                            ToolTip="Audio Files" Margin="4" x:Name="AudioToolButton">
                        <TextBlock Text="A" FontWeight="Bold" FontSize="14"/>
                    </Button>

                    <Rectangle Height="1" Fill="{StaticResource BorderBrush}" Margin="6,8"/>

                    <Button Style="{StaticResource IconButtonStyle}" Click="ToggleOutput_Click"
                            ToolTip="Toggle Output" Margin="4" x:Name="OutputToolButton">
                        <TextBlock Text="O" FontWeight="Bold" FontSize="14"/>
                    </Button>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3">
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <Ellipse x:Name="StatusIndicator" Width="8" Height="8" Fill="{StaticResource SuccessBrush}" Margin="0,0,6,0"/>
                    <TextBlock x:Name="StatusText" Text="Ready"/>
                </StackPanel>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="ProjectNameDisplay" Text="No project loaded"
                           Foreground="{StaticResource SecondaryForegroundBrush}"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="FileNameDisplay" Text=""/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <TextBlock x:Name="CaretPositionDisplay" Text="Ln 1, Col 1" Margin="0,0,16,0"/>
                    <TextBlock Text="Ctrl+Enter: Run | Esc: Stop" Foreground="{StaticResource SecondaryForegroundBrush}" Margin="0,0,16,0"/>
                    <TextBlock Text="UTF-8" Foreground="{StaticResource SecondaryForegroundBrush}"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
