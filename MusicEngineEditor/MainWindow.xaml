<Window x:Class="MusicEngineEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit"
        Title="MusicEngine Editor"
        Height="700" Width="1000"
        MinHeight="400" MinWidth="600"
        Style="{StaticResource DarkWindowStyle}"
        WindowStartupLocation="CenterScreen">

    <Window.InputBindings>
        <KeyBinding Key="F5" Command="{Binding RunCommand}"/>
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SaveCommand}"/>
        <KeyBinding Key="O" Modifiers="Ctrl" Command="{Binding OpenCommand}"/>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding NewCommand}"/>
        <KeyBinding Key="Escape" Command="{Binding PanicCommand}"/>
    </Window.InputBindings>

    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top" Background="{StaticResource MenuBackgroundBrush}">
            <MenuItem Header="_File">
                <MenuItem Header="_New" InputGestureText="Ctrl+N" Click="NewScript_Click"/>
                <MenuItem Header="_Open..." InputGestureText="Ctrl+O" Click="OpenScript_Click"/>
                <MenuItem Header="_Save" InputGestureText="Ctrl+S" Click="SaveScript_Click"/>
                <MenuItem Header="Save _As..." Click="SaveScriptAs_Click"/>
                <Separator/>
                <MenuItem Header="E_xit" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="_Script">
                <MenuItem Header="_Run" InputGestureText="F5" Click="RunScript_Click"/>
                <MenuItem Header="_Stop All Notes" InputGestureText="Esc" Click="Panic_Click"/>
                <Separator/>
                <MenuItem Header="_Clear Output" Click="ClearOutput_Click"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About" Click="About_Click"/>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <Border DockPanel.Dock="Top" Background="{StaticResource ToolbarBackgroundBrush}" Padding="4">
            <DockPanel>
                <!-- Left: File & Run Buttons -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                    <Button Content="New" Style="{StaticResource ToolbarButtonStyle}" Click="NewScript_Click" ToolTip="New Script (Ctrl+N)"/>
                    <Button Content="Open" Style="{StaticResource ToolbarButtonStyle}" Click="OpenScript_Click" ToolTip="Open Script (Ctrl+O)" Margin="4,0,0,0"/>
                    <Button Content="Save" Style="{StaticResource ToolbarButtonStyle}" Click="SaveScript_Click" ToolTip="Save Script (Ctrl+S)" Margin="4,0,0,0"/>

                    <Rectangle Width="1" Fill="{StaticResource BorderBrush}" Margin="12,2"/>

                    <Button x:Name="RunButton" Content="Run (F5)" Style="{StaticResource RunButtonStyle}" Click="RunScript_Click" ToolTip="Execute Script (F5)"/>
                    <Button Content="Stop" Style="{StaticResource ToolbarButtonStyle}" Click="Panic_Click" ToolTip="All Notes Off (Esc)" Margin="4,0,0,0"/>
                </StackPanel>

                <!-- Right: Status Display -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" VerticalAlignment="Center">
                    <TextBlock Text="BPM:" Foreground="{StaticResource SecondaryForegroundBrush}" VerticalAlignment="Center"/>
                    <TextBlock x:Name="BpmDisplay" Text="120" Foreground="{StaticResource ForegroundBrush}" Margin="4,0,16,0" FontWeight="Bold" VerticalAlignment="Center"/>

                    <TextBlock Text="Beat:" Foreground="{StaticResource SecondaryForegroundBrush}" VerticalAlignment="Center"/>
                    <TextBlock x:Name="BeatDisplay" Text="0.00" Foreground="{StaticResource ForegroundBrush}" Margin="4,0,0,0" FontWeight="Bold" Width="50" VerticalAlignment="Center"/>
                </StackPanel>

                <Border/> <!-- Spacer -->
            </DockPanel>
        </Border>

        <!-- Status Bar -->
        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock x:Name="StatusText" Text="Ready"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="FileNameDisplay" Text="Untitled"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Patterns: "/>
                    <TextBlock x:Name="PatternCountDisplay" Text="0"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>

        <!-- Main Content: Editor + Output -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="3*" MinHeight="100"/>
                <RowDefinition Height="5"/>
                <RowDefinition Height="*" MinHeight="80"/>
            </Grid.RowDefinitions>

            <!-- Code Editor -->
            <Border Grid.Row="0" Background="{StaticResource EditorBackgroundBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                <avalonedit:TextEditor
                    x:Name="CodeEditor"
                    FontFamily="JetBrains Mono, Consolas, Courier New"
                    FontSize="14"
                    ShowLineNumbers="True"
                    Background="{StaticResource EditorBackgroundBrush}"
                    Foreground="{StaticResource ForegroundBrush}"
                    LineNumbersForeground="{StaticResource SecondaryForegroundBrush}"
                    Padding="4"
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Auto"/>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch" ResizeDirection="Rows"/>

            <!-- Output Panel -->
            <Border Grid.Row="2" Background="{StaticResource PanelBackgroundBrush}">
                <DockPanel>
                    <!-- Output Header -->
                    <Border DockPanel.Dock="Top" Background="#252526" Padding="8,4">
                        <DockPanel>
                            <TextBlock Text="OUTPUT" FontWeight="SemiBold" Foreground="{StaticResource SecondaryForegroundBrush}" FontSize="11"/>
                            <Button Content="Clear" Style="{StaticResource ToolbarButtonStyle}" Click="ClearOutput_Click" DockPanel.Dock="Right" FontSize="11" Padding="6,2"/>
                        </DockPanel>
                    </Border>

                    <!-- Output Content -->
                    <TextBox x:Name="OutputBox"
                             Style="{StaticResource OutputTextBoxStyle}"
                             TextWrapping="NoWrap"
                             AcceptsReturn="True"/>
                </DockPanel>
            </Border>
        </Grid>
    </DockPanel>
</Window>
